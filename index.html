<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¦¬ëœì„œ ì¼ì • ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        /* ë¡œê·¸ì¸ í™”ë©´ */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .login-header p {
            color: #666;
            font-size: 14px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2196F3;
        }

        .login-btn {
            padding: 12px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: #0b7dda;
        }

        .demo-accounts {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #999;
        }

        .demo-accounts p {
            margin-bottom: 8px;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 15px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .welcome-message {
            color: #666;
            font-size: 14px;
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .user-toggle {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #0b7dda;
        }

        .btn-outline {
            background: white;
            color: #666;
            border: 1px solid #ddd;
        }

        .btn-outline:hover {
            background: #f5f5f5;
        }

        .btn-outline.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .btn-logout {
            background: #f44336;
            color: white;
        }

        .btn-logout:hover {
            background: #d32f2f;
        }

        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .calendar {
            margin: 20px 0;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day-header {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: #666;
            font-size: 14px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            min-height: 80px;
        }

        .calendar-day:hover {
            background: #f5f5f5;
            border-color: #2196F3;
        }

        .calendar-day.has-event {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .day-number {
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }

        .event-dot {
            width: 6px;
            height: 6px;
            background: #2196F3;
            border-radius: 50%;
            display: inline-block;
            margin-right: 3px;
        }

        .event-preview {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }

        /* ì¼ì • ëª©ë¡ */
        .schedule-list {
            margin-top: 30px;
        }

        .schedule-item {
            background: #f9f9f9;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .schedule-title {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .schedule-date {
            color: #666;
            font-size: 14px;
        }

        .schedule-status {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 14px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-unconfirmed {
            background: #ffebee;
            color: #c62828;
        }

        .status-confirmed {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status-completed {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* í”„ë¦¬ëœì„œ í™”ë©´ */
        .freelancer-view .schedule-item {
            border-left-color: #4CAF50;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* í•„í„° */
        .filter-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            flex: 1;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px 15px;
                border-radius: 8px;
            }

            /* ë¡œê·¸ì¸ í™”ë©´ ëª¨ë°”ì¼ */
            .login-container {
                margin: 50px auto;
                padding: 30px 20px;
            }

            .login-header h1 {
                font-size: 20px;
            }

            .demo-accounts {
                font-size: 11px;
            }

            /* í—¤ë” ëª¨ë°”ì¼ ìµœì í™” */
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .header-left {
                text-align: center;
            }

            .header-right {
                flex-direction: column;
                gap: 10px;
            }

            h1 {
                font-size: 20px;
            }

            .welcome-message {
                font-size: 13px;
            }

            .user-toggle {
                width: 100%;
                justify-content: center;
            }

            .user-toggle .btn {
                flex: 1;
                padding: 12px;
                font-size: 15px;
            }

            .btn-logout {
                width: 100%;
                padding: 12px;
                font-size: 15px;
            }

            /* í†µê³„ ì¹´ë“œ ëª¨ë°”ì¼ */
            .stats {
                flex-wrap: wrap;
                gap: 10px;
            }

            .stat-card {
                min-width: calc(50% - 5px);
                padding: 12px;
            }

            .stat-number {
                font-size: 20px;
            }

            .stat-label {
                font-size: 11px;
            }

            /* ë²„íŠ¼ ëª¨ë°”ì¼ ìµœì í™” */
            .btn {
                padding: 12px 16px;
                font-size: 15px;
            }

            .btn-primary {
                width: 100%;
                padding: 14px;
                font-size: 16px;
            }

            /* í•„í„° ì„¹ì…˜ ëª¨ë°”ì¼ */
            .filter-section {
                gap: 8px;
            }

            .filter-section .btn {
                flex: 1 1 calc(50% - 4px);
                min-width: calc(50% - 4px);
                padding: 10px 8px;
                font-size: 13px;
            }

            /* ìº˜ë¦°ë” ëª¨ë°”ì¼ ìµœì í™” */
            .calendar-header {
                flex-wrap: wrap;
                gap: 10px;
            }

            .calendar-month {
                width: 100%;
                text-align: center;
                font-size: 18px;
                order: -1;
            }

            .calendar-header .btn {
                flex: 1;
                padding: 10px;
            }

            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-day {
                min-height: 60px;
                padding: 5px;
            }

            .calendar-day-header {
                font-size: 12px;
                padding: 8px 5px;
            }
            
            .day-number {
                font-size: 12px;
            }
            
            .event-preview {
                font-size: 9px;
                line-height: 1.3;
            }

            .event-dot {
                width: 4px;
                height: 4px;
            }

            /* ì¼ì • ëª©ë¡ ëª¨ë°”ì¼ */
            .schedule-list {
                margin-top: 20px;
            }

            .schedule-item {
                padding: 12px;
                margin-bottom: 12px;
            }

            .schedule-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .schedule-title {
                font-size: 15px;
            }

            .schedule-date {
                font-size: 13px;
            }

            .schedule-status {
                flex-wrap: wrap;
                font-size: 13px;
            }

            .status-badge {
                font-size: 11px;
                padding: 3px 10px;
            }

            /* ì•¡ì…˜ ë²„íŠ¼ ëª¨ë°”ì¼ */
            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .action-buttons .btn {
                width: 100%;
                padding: 12px;
            }

            /* ëª¨ë‹¬ ëª¨ë°”ì¼ ìµœì í™” */
            .modal-content {
                width: 95%;
                padding: 25px 20px;
                max-height: 85vh;
            }

            .modal-header {
                font-size: 18px;
                margin-bottom: 15px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .form-group label {
                font-size: 14px;
                margin-bottom: 6px;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 12px;
                font-size: 16px; /* iOSì—ì„œ ìë™ ì¤Œ ë°©ì§€ */
            }

            .form-group textarea {
                min-height: 70px;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì…ë ¥ í•„ë“œ í„°ì¹˜ ê°œì„  */
            input[type="text"],
            input[type="password"],
            input[type="date"],
            select,
            textarea {
                -webkit-appearance: none;
                appearance: none;
                border-radius: 6px;
            }

            /* í”„ë¦¬ëœì„œ ìš”ì•½ ì •ë³´ ëª¨ë°”ì¼ */
            #freelancerSummary {
                padding: 12px;
            }

            #freelancerSummary > div:first-child {
                font-size: 15px;
            }

            #summaryTotal {
                font-size: 16px;
            }

            #summaryMeetings {
                font-size: 12px;
            }

            #adminFreelancerSelect {
                width: 100%;
                padding: 12px;
                font-size: 15px;
                margin-top: 5px;
            }

            /* ì˜¤ëŠ˜ì˜ ì¼ì • ëª¨ë°”ì¼ */
            #todaySchedules {
                padding: 12px;
            }

            #todaySchedules > div:first-child {
                font-size: 15px;
                flex-wrap: wrap;
            }

            #todayScheduleList > div {
                min-width: 100% !important;
                font-size: 13px;
            }

            /* í„°ì¹˜ ë°˜ì‘ ê°œì„  */
            .btn,
            .calendar-day,
            .schedule-item {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }
        }

        /* ì‘ì€ ëª¨ë°”ì¼ (360px ì´í•˜) */
        @media (max-width: 360px) {
            .container {
                padding: 15px 10px;
            }

            h1 {
                font-size: 18px;
            }

            .stat-card {
                min-width: 100%;
            }

            .filter-section .btn {
                flex: 1 1 100%;
                min-width: 100%;
            }

            .calendar-day {
                min-height: 50px;
                padding: 3px;
            }

            .day-number {
                font-size: 11px;
            }

            .event-preview {
                font-size: 8px;
            }
        }

        /* ì•„ì½”ë””ì–¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì—‘ì…€ ë‹¤ìš´ë¡œë“œìš©) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="login-container">
        <div class="login-header">
            <h1>ì†ê¸°ì‚¬ í˜„ì¥ì†ê¸° ì¼ì • ê´€ë¦¬</h1>
            <p>ë¡œê·¸ì¸í•˜ì—¬ ì¼ì •ì„ í™•ì¸í•˜ì„¸ìš”</p>
        </div>
        <div class="error-message" id="loginError"></div>
        <form class="login-form" onsubmit="handleLogin(event)">
            <div class="form-group">
                <label>ì•„ì´ë””</label>
                <input type="text" id="loginUsername" required placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <button type="submit" class="login-btn">ë¡œê·¸ì¸</button>
        </form>
        <div style="text-align: center; margin-top: 15px;">
            <button onclick="showSignupScreen()" style="background: none; border: none; color: #2196F3; cursor: pointer; text-decoration: underline; font-size: 14px;">ì†ê¸°ì‚¬ íšŒì›ê°€ì…</button>
        </div>
        <div class="demo-accounts">
            <p><strong>ë°ëª¨ ê³„ì • ì•ˆë‚´</strong></p>
            <p>ê´€ë¦¬ì: ê¹€ìˆ˜ê²½, ë°•ì‹ ì˜, ë°•í˜•ê·œ</p>
            <p>ê°€ì… ëŒ€ê¸° ì¤‘: ê¹€ì² ìˆ˜, ì´ì˜í¬ (í…ŒìŠ¤íŠ¸ìš©)</p>
            <p>ëª¨ë“  ê³„ì • ë¹„ë°€ë²ˆí˜¸: 1234</p>
        </div>
    </div>

    <!-- íšŒì›ê°€ì… í™”ë©´ -->
    <div id="signupScreen" class="login-container" style="display: none;">
        <div class="login-header">
            <h1>ì†ê¸°ì‚¬ íšŒì›ê°€ì…</h1>
            <p>ê°€ì… ì‹ ì²­ í›„ ê´€ë¦¬ì ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
        </div>
        <div class="error-message" id="signupError"></div>
        <form class="login-form" onsubmit="handleSignup(event)">
            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" id="signupName" required placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label>ì „í™”ë²ˆí˜¸</label>
                <input type="tel" id="signupPhone" required placeholder="010-1234-5678">
            </div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="signupEmail" required placeholder="example@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="signupPassword" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" id="signupPasswordConfirm" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <button type="submit" class="login-btn">ê°€ì… ì‹ ì²­</button>
        </form>
        <div style="text-align: center; margin-top: 15px;">
            <button onclick="showLoginScreen()" style="background: none; border: none; color: #666; cursor: pointer; text-decoration: underline; font-size: 14px;">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <!-- íšŒì›ê°€ì… ì„±ê³µ í™”ë©´ -->
    <div id="signupSuccessScreen" class="login-container" style="display: none;">
        <div style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 48px; margin-bottom: 20px;">âœ…</div>
            <h2 style="color: #333; margin-bottom: 15px;">ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2>
            <p style="color: #666; font-size: 15px; line-height: 1.6;">
                ë‹´ë‹¹ì í™•ì¸ í›„ ìŠ¹ì¸ë  ì˜ˆì •ì…ë‹ˆë‹¤.<br>
                ìŠ¹ì¸ ì™„ë£Œ ì‹œ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </p>
            <button class="btn" onclick="showLoginScreen()" style="margin-top: 30px; width: 100%; background: #4CAF50; color: white; padding: 14px; font-size: 16px;">í™•ì¸</button>
        </div>
    </div>

    <!-- ë©”ì¸ í™”ë©´ -->
    <div id="mainScreen" class="container" style="display: none;">
        <div class="header">
            <div class="header-left">
                <h1 id="pageTitle">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                <div class="welcome-message" id="welcomeMessage"></div>
            </div>
            <div class="header-right">
                <div class="user-toggle" id="viewToggle">
                    <button class="btn btn-outline active" onclick="switchView('admin')">ê´€ë¦¬ì</button>
                    <button class="btn btn-outline" onclick="switchView('freelancer')">í”„ë¦¬ëœì„œ</button>
                    <button class="btn btn-outline" onclick="switchView('users')">íšŒì› ê´€ë¦¬</button>
                </div>
                <button class="btn btn-logout" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <!-- ê´€ë¦¬ì í™”ë©´ -->
        <div id="adminView">
            <!-- í†µê³„ & ì•¡ì…˜ ë²„íŠ¼ -->
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                <!-- í†µê³„ ì¹´ë“œ -->
                <div class="stats" style="margin-bottom: 0; flex: 1; min-width: 280px;">
                    <div class="stat-card">
                        <div class="stat-number" id="totalSchedules">0</div>
                        <div class="stat-label">ì´ ì¼ì •</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="unconfirmedCount">0</div>
                        <div class="stat-label">ë¯¸í™•ì¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="confirmedCount">0</div>
                        <div class="stat-label">í™•ì¸ ì™„ë£Œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedCount">0</div>
                        <div class="stat-label">ì°¸ì„ ì™„ë£Œ</div>
                    </div>
                </div>
                
                <!-- ì•¡ì…˜ ë²„íŠ¼ ê·¸ë£¹ -->
                <div style="display: flex; gap: 10px; flex-shrink: 0; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="openAddScheduleModal()" style="white-space: nowrap;">+ ìƒˆ ì¼ì • ë“±ë¡</button>
                    <button class="btn" onclick="downloadExcel()" style="background: #10b981; color: white; white-space: nowrap;">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>

            <!-- ë‚ ì§œ ë²”ìœ„ í•„í„° -->
            <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                    <label style="font-weight: 600; color: #333; margin-right: 5px;">ğŸ“… ê¸°ê°„:</label>
                    <button class="btn btn-outline active" onclick="setDateRange('all')" id="dateRange-all" style="font-size: 13px; padding: 8px 16px;">ì „ì²´</button>
                    <button class="btn btn-outline" onclick="setDateRange('today')" id="dateRange-today" style="font-size: 13px; padding: 8px 16px;">ì˜¤ëŠ˜</button>
                    <button class="btn btn-outline" onclick="setDateRange('week')" id="dateRange-week" style="font-size: 13px; padding: 8px 16px;">ì´ë²ˆ ì£¼</button>
                    <button class="btn btn-outline" onclick="setDateRange('month')" id="dateRange-month" style="font-size: 13px; padding: 8px 16px;">ì´ë²ˆ ë‹¬</button>
                    
                    <div style="border-left: 2px solid #ddd; height: 30px; margin: 0 5px;"></div>
                    
                    <input type="date" id="customStartDate" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                    <span style="color: #999;">~</span>
                    <input type="date" id="customEndDate" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                    <button class="btn btn-primary" onclick="setDateRange('custom')" style="font-size: 13px; padding: 8px 16px;">ì ìš©</button>
                </div>
                <div id="dateRangeDisplay" style="margin-top: 10px; color: #2196F3; font-size: 13px; font-weight: 500;"></div>
            </div>

            <div class="filter-section" style="margin-top: 20px;">
                <button class="btn btn-outline active" onclick="filterSchedules('all')">ì „ì²´</button>
                <button class="btn btn-outline" onclick="filterSchedules('unconfirmed')">ë¯¸í™•ì¸ë§Œ</button>
                <button class="btn btn-outline" onclick="filterSchedules('confirmed')">í™•ì¸ ì™„ë£Œë§Œ</button>
                <button class="btn btn-outline" onclick="filterSchedules('completed')">ì°¸ì„ ì™„ë£Œë§Œ</button>
            </div>

            <!-- í”„ë¦¬ëœì„œ ì„ íƒ -->
            <div style="margin-top: 20px; margin-bottom: 15px;">
                <label style="font-weight: 500; color: #666; margin-right: 10px;">ì†ê¸°ì‚¬ ì„ íƒ:</label>
                <select id="adminFreelancerSelect" onchange="filterByFreelancer()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                    <option value="">ì „ì²´ ë³´ê¸°</option>
                    <!-- ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ë§Œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                </select>
            </div>

            <!-- ì†ê¸°ì‚¬ ìš”ì•½ ì •ë³´ -->
            <div id="freelancerSummary" style="display: none; background: #f0f7ff; border: 2px solid #2196F3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <div style="font-weight: bold; color: #2196F3; margin-bottom: 10px; font-size: 16px;" id="summaryTitle"></div>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div>
                        <span style="color: #666; font-size: 14px;">ì´ë²ˆ ë‹¬ ì¶œì¥:</span>
                        <span style="font-weight: bold; color: #333; font-size: 18px; margin-left: 5px;" id="summaryTotal">0</span>
                        <span style="color: #666; font-size: 14px;">ê±´</span>
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">ë°©ë¬¸ êµìœ¡ì§€ì›ì²­:</div>
                        <div id="summaryMeetings" style="color: #333; font-size: 13px; line-height: 1.6;"></div>
                    </div>
                </div>
            </div>

            <!-- ì˜¤ëŠ˜ì˜ ì¼ì • -->
            <div id="todaySchedules" style="background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <div style="font-weight: bold; color: #333; margin-bottom: 12px; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                    <span>ğŸ“… ì˜¤ëŠ˜ì˜ ì¼ì •</span>
                    <span id="todayDate" style="color: #666; font-size: 14px; font-weight: normal;"></span>
                </div>
                <div id="todayScheduleList" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
            </div>

            <div class="calendar">
                <div class="calendar-header">
                    <button class="btn btn-outline" onclick="changeMonth(-1)">â—€ ì´ì „</button>
                    <div class="calendar-month" id="currentMonth"></div>
                    <button class="btn btn-outline" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <div class="schedule-list" id="adminScheduleList"></div>
        </div>

        <!-- í”„ë¦¬ëœì„œ í™”ë©´ -->
        <div id="freelancerView" style="display: none;">
            <div class="calendar">
                <div class="calendar-header">
                    <button class="btn btn-outline" onclick="changeMonth(-1)">â—€ ì´ì „</button>
                    <div class="calendar-month" id="freelancerCurrentMonth"></div>
                    <button class="btn btn-outline" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
                </div>
                <div class="calendar-grid" id="freelancerCalendarGrid"></div>
            </div>

            <div class="schedule-list freelancer-view" id="freelancerScheduleList"></div>
        </div>

        <!-- íšŒì› ê´€ë¦¬ í™”ë©´ -->
        <div id="usersView" style="display: none;">
            <!-- ê°€ì… ëŒ€ê¸° ëª©ë¡ -->
            <div style="margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="font-size: 18px; color: #333;">ê°€ì… ëŒ€ê¸° ì¤‘ (<span id="pendingCount">0</span>ëª…)</h2>
                </div>
                <div id="pendingUsersList"></div>
            </div>

            <!-- ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ ëª©ë¡ -->
            <div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="font-size: 18px; color: #333;">ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ (<span id="approvedCount">0</span>ëª…)</h2>
                </div>
                <div id="approvedUsersList"></div>
            </div>
        </div>
    </div>

    <!-- ì¼ì • ë“±ë¡ ëª¨ë‹¬ -->
    <div class="modal" id="addScheduleModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">ìƒˆ ì¼ì • ë“±ë¡</div>
            <form onsubmit="addSchedule(event)">
                <div class="form-group">
                    <label>í”„ë¦¬ëœì„œ ì„ íƒ</label>
                    <select id="scheduleFreelancer" required onchange="updateFreelancerSuggestions()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ë§Œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                    </select>
                </div>
                <div class="form-group">
                    <label>íšŒì˜ëª…</label>
                    <input type="text" id="scheduleTitle" required placeholder="íšŒì˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" list="meetingList">
                    <datalist id="meetingList"></datalist>
                </div>
                
                <!-- ë‚ ì§œ ì„ íƒ ìº˜ë¦°ë” -->
                <div class="form-group">
                    <label>ë‚ ì§œ ì„ íƒ (ì—¬ëŸ¬ ë‚ ì§œ ì„ íƒ ê°€ëŠ¥)</label>
                    <div style="background: #f9f9f9; border: 1px solid #ddd; border-radius: 6px; padding: 15px; margin-top: 5px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <button type="button" class="btn btn-outline" onclick="changeBulkMonth(-1)" style="padding: 5px 10px;">â—€</button>
                            <div id="bulkMonthDisplay" style="font-weight: bold;"></div>
                            <button type="button" class="btn btn-outline" onclick="changeBulkMonth(1)" style="padding: 5px 10px;">â–¶</button>
                        </div>
                        <div id="bulkDateSelector" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;"></div>
                    </div>
                    <div style="margin-top: 10px; color: #666; font-size: 13px;">
                        ì„ íƒëœ ë‚ ì§œ: <span id="selectedDatesDisplay">ì—†ìŒ</span>
                    </div>
                </div>

                <!-- ì„ íƒëœ ë‚ ì§œë³„ ì‹œê°„ ì„¤ì • -->
                <div class="form-group" id="timeSettingsContainer" style="display: none;">
                    <label>ë‚ ì§œë³„ ì‹œê°„ ì„¤ì •</label>
                    <div id="timeSettingsList" style="background: #f9f9f9; border: 1px solid #ddd; border-radius: 6px; padding: 15px; max-height: 300px; overflow-y: auto;"></div>
                </div>

                <div class="form-group">
                    <label>ë©”ëª¨</label>
                    <textarea id="scheduleMemo" placeholder="ì¶”ê°€ ì•ˆë‚´ì‚¬í•­"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ë“±ë¡</button>
                    <button type="button" class="btn btn-outline" style="flex: 1;" onclick="closeAddScheduleModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ë‚ ì§œ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div class="modal" id="dateDetailModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                <div id="dateDetailTitle"></div>
                <button onclick="closeDateDetailModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
            </div>
            <div id="dateDetailContent" style="max-height: 500px; overflow-y: auto;"></div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-outline" onclick="closeDateDetailModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì¼ì • ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="editScheduleModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">ì¼ì • ìˆ˜ì •</div>
            <form onsubmit="saveScheduleEdit(event)">
                <input type="hidden" id="editScheduleIdField">
                
                <div class="form-group">
                    <label>í”„ë¦¬ëœì„œ ì„ íƒ</label>
                    <select id="editScheduleFreelancer" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ë§Œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label>íšŒì˜ëª…</label>
                    <input type="text" id="editScheduleTitle" required placeholder="íšŒì˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                    <label>ë‚ ì§œ</label>
                    <input type="date" id="editScheduleDate" required>
                </div>
                
                <div class="form-group">
                    <label>ì‹œê°„</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="editScheduleHour" min="0" max="23" required style="width: 80px; text-align: center;" placeholder="00">
                        <span>ì‹œ</span>
                        <input type="number" id="editScheduleMinute" min="0" max="59" step="30" required style="width: 80px; text-align: center;" placeholder="00">
                        <span>ë¶„</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ë©”ëª¨</label>
                    <textarea id="editScheduleMemo" placeholder="ì¶”ê°€ ì•ˆë‚´ì‚¬í•­"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ìˆ˜ì • ì™„ë£Œ</button>
                    <button type="button" class="btn btn-outline" style="flex: 1;" onclick="closeEditScheduleModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì¼ì • ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="editScheduleModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">ì¼ì • ìˆ˜ì •</div>
            <form onsubmit="updateSchedule(event)">
                <input type="hidden" id="editScheduleIdField">
                
                <div class="form-group">
                    <label>í”„ë¦¬ëœì„œ ì„ íƒ</label>
                    <select id="editScheduleFreelancer" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ë§Œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label>íšŒì˜ëª…</label>
                    <input type="text" id="editScheduleTitle" required placeholder="íšŒì˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                    <label>ë‚ ì§œ</label>
                    <input type="date" id="editScheduleDate" required>
                </div>
                
                <div class="form-group">
                    <label>ì‹œê°„</label>
                    <select id="editScheduleTime" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="">ì‹œê°„ ì„ íƒ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ë©”ëª¨</label>
                    <textarea id="editScheduleMemo" placeholder="ì¶”ê°€ ì•ˆë‚´ì‚¬í•­"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ìˆ˜ì • ì™„ë£Œ</button>
                    <button type="button" class="btn btn-outline" style="flex: 1;" onclick="closeEditScheduleModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì‹œê°„ ê¸°ë¡ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="editTimeLogModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">íšŒì˜ ì‹œê°„ ìˆ˜ì •</div>
            <form onsubmit="saveTimeLogEdit(event)">
                <input type="hidden" id="editScheduleId">
                
                <div class="form-group">
                    <label>ì‹œì‘ ì‹œê°„</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="editStartHour" min="0" max="23" required style="width: 80px; text-align: center;" placeholder="00">
                        <span>ì‹œ</span>
                        <input type="number" id="editStartMinute" min="0" max="59" required style="width: 80px; text-align: center;" placeholder="00">
                        <span>ë¶„</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>ì¢…ë£Œ ì‹œê°„</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="editEndHour" min="0" max="23" required style="width: 80px; text-align: center;" placeholder="00">
                        <span>ì‹œ</span>
                        <input type="number" id="editEndMinute" min="0" max="59" required style="width: 80px; text-align: center;" placeholder="00">
                        <span>ë¶„</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>ì •íšŒ ì‹œê°„ (ì´ ëª‡ ë¶„ ì‰¬ì—ˆë‚˜ìš”?)</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="editBreakMinutes" min="0" value="0" style="width: 100px; text-align: center;">
                        <span>ë¶„</span>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">ì˜ˆ: 30ë¶„ ì •íšŒí–ˆë‹¤ë©´ 30 ì…ë ¥</div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ì €ì¥</button>
                    <button type="button" class="btn btn-outline" style="flex: 1;" onclick="closeEditTimeLogModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        // ============================================
        // Firebase SDK Import
        // ============================================
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            addDoc, 
            updateDoc,
            deleteDoc,
            doc,
            onSnapshot,
            setDoc,
            getDoc
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Firebase ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyDDFkY96V7UfVIG_aFt8AMwBg8ng8fYh1s",
            authDomain: "thrltk-6f4a6.firebaseapp.com",
            projectId: "thrltk-6f4a6",
            storageBucket: "thrltk-6f4a6.firebasestorage.app",
            messagingSenderId: "28382177873",
            appId: "1:28382177873:web:1532a2760b0ab08f832670"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        console.log('âœ… Firebase ì—°ê²° ì™„ë£Œ');

        // ============================================
        // ê³„ì • ë°ì´í„° (Firebaseì—ì„œ ë¡œë“œ)
        // ============================================
        let accounts = {
            // ìŠˆí¼ ê´€ë¦¬ì (ê²½ì˜ì§„)
            'super': { password: '1234', role: 'superadmin', name: 'ê²½ì˜ì§„' },
            // ì¼ë°˜ ê´€ë¦¬ì ê³„ì •
            'ê¹€ìˆ˜ê²½': { password: '1234', role: 'admin', name: 'ê¹€ìˆ˜ê²½' },
            'ë°•ì‹ ì˜': { password: '1234', role: 'admin', name: 'ë°•ì‹ ì˜' },
            'ë°•í˜•ê·œ': { password: '1234', role: 'admin', name: 'ë°•í˜•ê·œ' }
        };

        // ê°€ì… ëŒ€ê¸° ì¤‘ì¸ ì‚¬ìš©ì (ë°ëª¨ìš©)
        let pendingUsers = [
            {
                id: 1,
                name: 'ê¹€ì² ìˆ˜',
                phone: '010-1234-5678',
                email: 'chulsu@email.com',
                password: '1234',
                requestDate: '2026-02-20 10:30'
            },
            {
                id: 2,
                name: 'ì´ì˜í¬',
                phone: '010-2345-6789',
                email: 'younghee@email.com',
                password: '1234',
                requestDate: '2026-02-21 09:15'
            }
        ];

        // ë°ëª¨ ë°ì´í„° (ì¼ì • ì—†ìŒ - ì†ê¸°ì‚¬ ìŠ¹ì¸ í›„ ë“±ë¡ ê°€ëŠ¥)
        let schedules = [];

        // í”„ë¦¬ëœì„œë³„ ê³¼ê±° íšŒì˜ëª… ë° ì‹œê°„ ë°ì´í„° (ì´ˆê¸°ì—ëŠ” ë¹„ì–´ìˆìŒ)
        const freelancerHistory = {};

        // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ íšŒì˜ ìƒíƒœ (í”„ë¦¬ëœì„œë³„)
        let ongoingMeetings = {}; // { scheduleId: { startTime, breaks: [...], isPaused } }

        let currentDate = new Date();
        let currentView = 'admin';
        let currentFilter = 'all';
        let currentUser = null;
        let selectedFreelancer = ''; // ê´€ë¦¬ìê°€ ì„ íƒí•œ í”„ë¦¬ëœì„œ
        
        // ë‚ ì§œ ë²”ìœ„ í•„í„°
        let dateRangeFilter = {
            type: 'all', // 'all', 'today', 'week', 'month', 'custom'
            startDate: null,
            endDate: null
        };
        
        // ì¼ê´„ ë“±ë¡ìš© ë³€ìˆ˜
        let bulkDate = new Date();
        let selectedDates = []; // ì„ íƒëœ ë‚ ì§œë“¤ ['2026-02-24', '2026-02-26', ...]
        let dateTimePairs = {}; // ë‚ ì§œë³„ ì‹œê°„ {'2026-02-24': '14:00', ...}

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadPendingUsers(); // localStorageì—ì„œ ê°€ì… ëŒ€ê¸° ëª©ë¡ ë¡œë“œ
            loadAccounts(); // localStorageì—ì„œ ê³„ì • ì •ë³´ ë¡œë“œ
            loadSchedules(); // localStorageì—ì„œ ì¼ì • ë¡œë“œ
            checkLogin();
        });

        // Firebaseì—ì„œ ê°€ì… ëŒ€ê¸° ëª©ë¡ ë¡œë“œ
        async function loadPendingUsers() {
            try {
                const pendingDoc = await getDoc(doc(db, 'system', 'pendingUsers'));
                if (pendingDoc.exists()) {
                    pendingUsers = pendingDoc.data().users || [];
                }
                console.log(`âœ… ê°€ì… ëŒ€ê¸°ì ${pendingUsers.length}ëª… ë¡œë“œ`);
            } catch (error) {
                console.error('ê°€ì… ëŒ€ê¸°ì ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // Firebaseì— ê°€ì… ëŒ€ê¸° ëª©ë¡ ì €ì¥
        async function savePendingUsers() {
            try {
                await setDoc(doc(db, 'system', 'pendingUsers'), { users: pendingUsers });
                console.log('âœ… ê°€ì… ëŒ€ê¸°ì ì €ì¥ ì™„ë£Œ');
            } catch (error) {
                console.error('ê°€ì… ëŒ€ê¸°ì ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        // Firebaseì—ì„œ ê³„ì • ì •ë³´ ë¡œë“œ
        async function loadAccounts() {
            try {
                const accountsDoc = await getDoc(doc(db, 'system', 'accounts'));
                if (accountsDoc.exists()) {
                    const loadedAccounts = accountsDoc.data();
                    // í”„ë¦¬ëœì„œ ê³„ì •ë§Œ ì¶”ê°€ (ê¸°ë³¸ ê´€ë¦¬ìëŠ” ìœ ì§€)
                    Object.entries(loadedAccounts).forEach(([id, user]) => {
                        if (user.role === 'freelancer') {
                            accounts[id] = user;
                        }
                    });
                }
                console.log('âœ… ê³„ì • ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('ê³„ì • ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // Firebaseì— ê³„ì • ì •ë³´ ì €ì¥
        async function saveAccounts() {
            try {
                await setDoc(doc(db, 'system', 'accounts'), accounts);
                console.log('âœ… ê³„ì • ì €ì¥ ì™„ë£Œ');
            } catch (error) {
                console.error('ê³„ì • ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        // Firebaseì—ì„œ ì¼ì • ë¡œë“œ
        async function loadSchedules() {
            try {
                const schedulesSnapshot = await getDocs(collection(db, 'schedules'));
                schedules = [];
                schedulesSnapshot.forEach(docSnap => {
                    schedules.push({ ...docSnap.data(), firestoreId: docSnap.id });
                });
                console.log(`âœ… ì¼ì • ${schedules.length}ê°œ ë¡œë“œ`);
            } catch (error) {
                console.error('ì¼ì • ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // localStorageì— ì¼ì • ì €ì¥
        // ì¼ì • ì €ì¥ (Firebase)
        async function saveSchedules() {
            try {
                for (const schedule of schedules) {
                    const scheduleData = { ...schedule };
                    delete scheduleData.firestoreId;
                    
                    if (schedule.firestoreId) {
                        await setDoc(doc(db, 'schedules', schedule.firestoreId), scheduleData);
                    } else {
                        const docRef = await addDoc(collection(db, 'schedules'), scheduleData);
                        schedule.firestoreId = docRef.id;
                    }
                }
            } catch (error) {
                console.error('ì¼ì • ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        // íšŒì›ê°€ì… í™”ë©´ í‘œì‹œ
        function showSignupScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('signupScreen').style.display = 'block';
            document.getElementById('signupSuccessScreen').style.display = 'none';
            document.getElementById('signupError').classList.remove('show');
        }

        // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('signupScreen').style.display = 'none';
            document.getElementById('signupSuccessScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginError').classList.remove('show');
        }

        // íšŒì›ê°€ì… ì²˜ë¦¬
        function handleSignup(event) {
            event.preventDefault();
            
            const name = document.getElementById('signupName').value;
            const phone = document.getElementById('signupPhone').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
            const errorEl = document.getElementById('signupError');

            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (password !== passwordConfirm) {
                errorEl.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                errorEl.classList.add('show');
                return;
            }

            // ì¤‘ë³µ í™•ì¸ (ì´ë¦„ìœ¼ë¡œ)
            if (accounts[name]) {
                errorEl.textContent = 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.';
                errorEl.classList.add('show');
                return;
            }

            // ì´ë¯¸ ëŒ€ê¸° ì¤‘ì¸ì§€ í™•ì¸
            if (pendingUsers.find(u => u.name === name || u.email === email)) {
                errorEl.textContent = 'ì´ë¯¸ ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                errorEl.classList.add('show');
                return;
            }

            // ê°€ì… ì‹ ì²­ ì¶”ê°€
            pendingUsers.push({
                id: pendingUsers.length + 1,
                name: name,
                phone: phone,
                email: email,
                password: password,
                requestDate: new Date().toISOString().slice(0, 16).replace('T', ' ')
            });

            // localStorageì— ì €ì¥ (ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€)
            savePendingUsers();

            // í¼ ì´ˆê¸°í™”
            event.target.reset();
            
            // ì„±ê³µ í™”ë©´ë§Œ í‘œì‹œ (ë‹¤ë¥¸ í™”ë©´ ëª¨ë‘ ìˆ¨ê¹€)
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('signupScreen').style.display = 'none';
            document.getElementById('signupSuccessScreen').style.display = 'block';
        }

        // ì´ˆê¸°í™”

        // ë¡œê·¸ì¸ í™•ì¸
        function checkLogin() {
            const user = sessionStorage.getItem('currentUser');
            if (user) {
                currentUser = JSON.parse(user);
                showMainScreen();
            } else {
                showLoginScreen();
            }
        }

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');

            if (accounts[username] && accounts[username].password === password) {
                currentUser = {
                    username: username,
                    role: accounts[username].role,
                    name: accounts[username].name
                };
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainScreen();
            } else {
                errorEl.textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                errorEl.classList.add('show');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function handleLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                sessionStorage.removeItem('currentUser');
                currentUser = null;
                showLoginScreen();
            }
        }

        // ë©”ì¸ í™”ë©´ í‘œì‹œ
        function showMainScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'block';
            
            // í™˜ì˜ ë©”ì‹œì§€
            document.getElementById('welcomeMessage').textContent = `${currentUser.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤`;
            
            // ì—­í• ì— ë”°ë¼ í™”ë©´ ì„¤ì •
            if (currentUser.role === 'admin' || currentUser.role === 'superadmin') {
                document.getElementById('viewToggle').style.display = 'flex';
                document.getElementById('adminView').style.display = 'block';
                document.getElementById('freelancerView').style.display = 'none';
                currentView = 'admin';
                document.getElementById('pageTitle').textContent = 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ';
                selectedFreelancer = ''; // í”„ë¦¬ëœì„œ í•„í„° ì´ˆê¸°í™”
                loadFreelancerOptions(); // ì†ê¸°ì‚¬ ëª©ë¡ ë¡œë“œ
                renderTodaySchedules();
                renderCalendar();
                renderScheduleList();
                updateStats();
            } else {
                document.getElementById('viewToggle').style.display = 'none';
                document.getElementById('adminView').style.display = 'none';
                document.getElementById('freelancerView').style.display = 'block';
                document.getElementById('usersView').style.display = 'none';
                currentView = 'freelancer';
                document.getElementById('pageTitle').textContent = 'ë‚´ ì¼ì •';
                loadFreelancerSchedules();
            }
        }

        // ë·° ì „í™˜ (ê´€ë¦¬ìë§Œ)
        function switchView(view) {
            if (currentUser.role !== 'admin' && currentUser.role !== 'superadmin') return;
            
            currentView = view;
            document.getElementById('adminView').style.display = view === 'admin' ? 'block' : 'none';
            document.getElementById('freelancerView').style.display = view === 'freelancer' ? 'block' : 'none';
            document.getElementById('usersView').style.display = view === 'users' ? 'block' : 'none';
            
            if (view === 'admin') {
                document.getElementById('pageTitle').textContent = 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ';
            } else if (view === 'freelancer') {
                document.getElementById('pageTitle').textContent = 'í”„ë¦¬ëœì„œ ë·°';
            } else if (view === 'users') {
                document.getElementById('pageTitle').textContent = 'íšŒì› ê´€ë¦¬';
            }
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ
            document.querySelectorAll('.user-toggle .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            if (view === 'freelancer') {
                loadFreelancerSchedules();
            } else if (view === 'admin') {
                renderTodaySchedules();
                renderCalendar();
                renderScheduleList();
            } else if (view === 'users') {
                renderPendingUsers();
                renderApprovedUsers();
            }
        }

        // ê°€ì… ëŒ€ê¸° ëª©ë¡ ë Œë”ë§
        function renderPendingUsers() {
            const listEl = document.getElementById('pendingUsersList');
            const countEl = document.getElementById('pendingCount');
            
            countEl.textContent = pendingUsers.length;
            listEl.innerHTML = '';

            if (pendingUsers.length === 0) {
                listEl.innerHTML = '<div style="color: #999; padding: 20px; text-align: center; background: #f9f9f9; border-radius: 8px;">ëŒ€ê¸° ì¤‘ì¸ ê°€ì… ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            pendingUsers.forEach(user => {
                const userCard = document.createElement('div');
                userCard.style.cssText = `
                    background: #fff;
                    border: 1px solid #e0e0e0;
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 10px;
                `;

                userCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="flex: 1; min-width: 200px;">
                            <div style="font-weight: bold; color: #333; font-size: 16px; margin-bottom: 5px;">${user.name}</div>
                            <div style="color: #666; font-size: 14px;">ğŸ“ ${user.phone}</div>
                            <div style="color: #666; font-size: 14px;">ğŸ“§ ${user.email}</div>
                            <div style="color: #999; font-size: 12px; margin-top: 5px;">ì‹ ì²­ì¼: ${user.requestDate}</div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="approveUser(${user.id})">ìŠ¹ì¸</button>
                            <button class="btn btn-outline" onclick="rejectUser(${user.id})" style="color: #f44336; border-color: #f44336;">ê±°ë¶€</button>
                        </div>
                    </div>
                `;

                listEl.appendChild(userCard);
            });
        }

        // ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ ëª©ë¡ ë Œë”ë§
        function renderApprovedUsers() {
            const listEl = document.getElementById('approvedUsersList');
            const countEl = document.getElementById('approvedCount');
            
            const approvedUsers = Object.entries(accounts)
                .filter(([id, user]) => user.role === 'freelancer' && user.approved)
                .map(([id, user]) => ({ id, ...user }));
            
            countEl.textContent = approvedUsers.length;
            listEl.innerHTML = '';

            approvedUsers.forEach(user => {
                const userCard = document.createElement('div');
                userCard.style.cssText = `
                    background: #f9f9f9;
                    border: 1px solid #e0e0e0;
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 10px;
                `;

                const displayName = user.id === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : user.name;

                userCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="flex: 1; min-width: 200px;">
                            <div style="font-weight: bold; color: #333; font-size: 16px; margin-bottom: 5px;">${displayName}</div>
                            <div style="color: #666; font-size: 14px;">ğŸ“ ${user.phone || '-'}</div>
                            <div style="color: #666; font-size: 14px;">ğŸ“§ ${user.email || '-'}</div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-outline" onclick="resetPassword('${user.id}')">ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”</button>
                            <button class="btn btn-outline" onclick="deleteUser('${user.id}')" style="color: #f44336; border-color: #f44336;">ì‚­ì œ</button>
                        </div>
                    </div>
                `;

                listEl.appendChild(userCard);
            });
        }

        // ìŠ¹ì¸ ì²˜ë¦¬
        function approveUser(userId) {
            const user = pendingUsers.find(u => u.id === userId);
            if (!user) return;

            if (confirm(`${user.name}ë‹˜ì˜ ê°€ì…ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // accountsì— ì¶”ê°€
                accounts[user.name] = {
                    password: user.password,
                    role: 'freelancer',
                    name: user.name,
                    phone: user.phone,
                    email: user.email,
                    approved: true
                };

                // í”„ë¦¬ëœì„œ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
                if (!freelancerHistory[user.name]) {
                    freelancerHistory[user.name] = {
                        meetings: [],
                        times: []
                    };
                }

                // pendingUsersì—ì„œ ì œê±°
                pendingUsers = pendingUsers.filter(u => u.id !== userId);
                savePendingUsers(); // localStorage ì—…ë°ì´íŠ¸
                saveAccounts(); // ê³„ì • ì •ë³´ë„ ì €ì¥

                alert(`${user.name}ë‹˜ì˜ ê°€ì…ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                loadFreelancerOptions(); // ë“œë¡­ë‹¤ìš´ ëª©ë¡ ì—…ë°ì´íŠ¸
                renderPendingUsers();
                renderApprovedUsers();
            }
        }

        // ê±°ë¶€ ì²˜ë¦¬
        function rejectUser(userId) {
            const user = pendingUsers.find(u => u.id === userId);
            if (!user) return;

            if (confirm(`${user.name}ë‹˜ì˜ ê°€ì…ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                pendingUsers = pendingUsers.filter(u => u.id !== userId);
                savePendingUsers(); // localStorage ì—…ë°ì´íŠ¸
                alert(`${user.name}ë‹˜ì˜ ê°€ì…ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                renderPendingUsers();
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
        function resetPassword(userId) {
            const user = accounts[userId];
            if (!user) return;

            const displayName = userId === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : user.name;
            const newPassword = prompt(`${displayName}ë‹˜ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`, '1234');
            
            if (newPassword && newPassword.trim()) {
                accounts[userId].password = newPassword.trim();
                alert(`${displayName}ë‹˜ì˜ ë¹„ë°€ë²ˆí˜¸ê°€ "${newPassword}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // ê³„ì • ì‚­ì œ
        function deleteUser(userId) {
            const user = accounts[userId];
            if (!user) return;

            const displayName = userId === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : user.name;
            
            if (confirm(`${displayName}ë‹˜ì˜ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                delete accounts[userId];
                saveAccounts(); // ê³„ì • ì •ë³´ ì €ì¥
                
                // í•´ë‹¹ ì†ê¸°ì‚¬ì˜ ì¼ì •ë„ ì‚­ì œí• ì§€ í™•ì¸
                if (confirm(`${displayName}ë‹˜ì˜ ëª¨ë“  ì¼ì •ë„ í•¨ê»˜ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    schedules = schedules.filter(s => s.freelancer !== userId);
                    saveSchedules(); // ì¼ì • ì €ì¥
                }

                alert(`${displayName}ë‹˜ì˜ ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                loadFreelancerOptions(); // ë“œë¡­ë‹¤ìš´ ëª©ë¡ ì—…ë°ì´íŠ¸
                renderApprovedUsers();
            }
        }

        // í”„ë¦¬ëœì„œë³„ í•„í„°ë§
        function filterByFreelancer() {
            selectedFreelancer = document.getElementById('adminFreelancerSelect').value;
            updateFreelancerSummary();
            renderTodaySchedules();
            renderCalendar();
            renderScheduleList();
        }

        // í”„ë¦¬ëœì„œ ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateFreelancerSummary() {
            const summaryDiv = document.getElementById('freelancerSummary');
            
            if (!selectedFreelancer) {
                summaryDiv.style.display = 'none';
                return;
            }

            summaryDiv.style.display = 'block';
            
            // í˜„ì¬ ì›”ì˜ ì‹œì‘ê³¼ ë
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // ì„ íƒëœ í”„ë¦¬ëœì„œì˜ ì´ë²ˆ ë‹¬ ì¼ì • í•„í„°ë§
            const freelancerSchedules = schedules.filter(s => {
                const scheduleDate = new Date(s.date);
                return s.freelancer === selectedFreelancer && 
                       scheduleDate >= firstDay && 
                       scheduleDate <= lastDay;
            });
            
            // í”„ë¦¬ëœì„œ ì´ë¦„ í‘œì‹œ
            const displayName = selectedFreelancer === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : selectedFreelancer;
            document.getElementById('summaryTitle').textContent = `${displayName} ì†ê¸°ì‚¬`;
            
            // ì´ ê±´ìˆ˜
            document.getElementById('summaryTotal').textContent = freelancerSchedules.length;
            
            // íšŒì˜ëª… ëª©ë¡ (ì¤‘ë³µ ì œê±°)
            const meetings = [...new Set(freelancerSchedules.map(s => s.title))];
            const meetingList = meetings.map(m => {
                const count = freelancerSchedules.filter(s => s.title === m).length;
                return `${m} (${count}ê±´)`;
            }).join(', ');
            
            document.getElementById('summaryMeetings').textContent = meetingList || 'ì¼ì • ì—†ìŒ';
        }

        // ì˜¤ëŠ˜ì˜ ì¼ì • ë Œë”ë§
        function renderTodaySchedules() {
            const todayDateEl = document.getElementById('todayDate');
            const todayListEl = document.getElementById('todayScheduleList');
            
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            // ë‚ ì§œ í‘œì‹œ
            const month = today.getMonth() + 1;
            const date = today.getDate();
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const dayName = dayNames[today.getDay()];
            todayDateEl.textContent = `(${month}ì›” ${date}ì¼ ${dayName}ìš”ì¼)`;
            
            // ì˜¤ëŠ˜ ì¼ì • í•„í„°ë§
            let todaySchedules = schedules.filter(s => s.date === todayStr);
            
            // ì†ê¸°ì‚¬ í•„í„° ì ìš©
            if (selectedFreelancer) {
                todaySchedules = todaySchedules.filter(s => s.freelancer === selectedFreelancer);
            }
            
            todayListEl.innerHTML = '';
            
            if (todaySchedules.length === 0) {
                todayListEl.innerHTML = '<div style="color: #999; font-size: 14px;">ì˜¤ëŠ˜ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // ìƒíƒœë³„ ìƒ‰ìƒ ë° ì•„ì´ì½˜
            const statusConfig = {
                'unconfirmed': { color: '#ff5252', icon: 'ğŸ”´', text: 'ë¯¸í™•ì¸' },
                'confirmed': { color: '#4caf50', icon: 'ğŸŸ¢', text: 'í™•ì¸ ì™„ë£Œ' },
                'completed': { color: '#2196f3', icon: 'ğŸ”µ', text: 'ì°¸ì„ ì™„ë£Œ' }
            };
            
            todaySchedules.forEach(schedule => {
                const config = statusConfig[schedule.status];
                const displayName = schedule.freelancer === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : schedule.freelancer;
                
                const scheduleEl = document.createElement('div');
                scheduleEl.style.cssText = `
                    background: #f9f9f9;
                    border-left: 4px solid ${config.color};
                    padding: 10px 12px;
                    border-radius: 6px;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    min-width: 280px;
                    flex: 1;
                `;
                
                scheduleEl.innerHTML = `
                    <span style="font-size: 14px;">${config.icon}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; color: #333; font-size: 14px;">
                            ${displayName} - ${schedule.title}
                        </div>
                        <div style="color: #666; font-size: 13px; margin-top: 2px;">
                            ${schedule.time}
                        </div>
                    </div>
                    <div style="font-size: 11px; color: ${config.color}; font-weight: 500;">
                        ${config.text}
                    </div>
                `;
                
                todayListEl.appendChild(scheduleEl);
            });
        }

        // ìº˜ë¦°ë” ë Œë”ë§
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthEl = document.getElementById(currentView === 'admin' ? 'currentMonth' : 'freelancerCurrentMonth');
            monthEl.textContent = `${year}ë…„ ${month + 1}ì›”`;

            const gridEl = document.getElementById(currentView === 'admin' ? 'calendarGrid' : 'freelancerCalendarGrid');
            gridEl.innerHTML = '';

            // ìš”ì¼ í—¤ë”
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                gridEl.appendChild(dayHeader);
            });

            // ë‚ ì§œ ê³„ì‚°
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            // ë¹ˆ ì¹¸ ì±„ìš°ê¸°
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                gridEl.appendChild(emptyDay);
            }

            // ë‚ ì§œ ì±„ìš°ê¸°
            for (let date = 1; date <= lastDate; date++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                
                // í•´ë‹¹ ë‚ ì§œì˜ ì¼ì • ì°¾ê¸°
                const daySchedules = schedules.filter(s => {
                    if (currentView === 'freelancer' && currentUser.role === 'freelancer') {
                        return s.date === dateStr && s.freelancer === currentUser.username;
                    }
                    // ê´€ë¦¬ì ë·°ì—ì„œ í”„ë¦¬ëœì„œ ì„ íƒëœ ê²½ìš°
                    if (currentView === 'admin' && selectedFreelancer) {
                        return s.date === dateStr && s.freelancer === selectedFreelancer;
                    }
                    return s.date === dateStr;
                });

                dayEl.innerHTML = `<div class="day-number">${date}</div>`;
                
                if (daySchedules.length > 0) {
                    dayEl.classList.add('has-event');
                    const preview = document.createElement('div');
                    preview.className = 'event-preview';
                    
                    // ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ í‘œì‹œ
                    const displaySchedules = daySchedules.slice(0, 3);
                    preview.innerHTML = displaySchedules.map(s => 
                        `<span class="event-dot"></span>${s.title}`
                    ).join('<br>');
                    
                    // 3ê°œ ë„˜ìœ¼ë©´ ë”ë³´ê¸° í‘œì‹œ
                    if (daySchedules.length > 3) {
                        const moreDiv = document.createElement('div');
                        moreDiv.style.cssText = 'color: #2196F3; font-weight: bold; margin-top: 3px; cursor: pointer;';
                        moreDiv.textContent = `+${daySchedules.length - 3}ê°œ ë”ë³´ê¸°`;
                        preview.appendChild(moreDiv);
                    }
                    
                    dayEl.appendChild(preview);
                    
                    // ë‚ ì§œ í´ë¦­ ì‹œ ìƒì„¸ë³´ê¸°
                    dayEl.style.cursor = 'pointer';
                    dayEl.onclick = () => showDateDetail(dateStr, daySchedules);
                } else {
                    // ì¼ì • ì—†ëŠ” ë‚ ë„ í´ë¦­ ê°€ëŠ¥ (ê´€ë¦¬ìë§Œ)
                    if (currentView === 'admin') {
                        dayEl.style.cursor = 'pointer';
                        dayEl.onclick = () => showDateDetail(dateStr, []);
                    }
                }

                gridEl.appendChild(dayEl);
            }
        }

        // ì›” ë³€ê²½
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            if (selectedFreelancer) {
                updateFreelancerSummary();
            }
            renderCalendar();
        }

        // ë‚ ì§œ ìƒì„¸ë³´ê¸° í‘œì‹œ
        function showDateDetail(dateStr, daySchedules) {
            const date = new Date(dateStr);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const dayName = dayNames[date.getDay()];
            
            // ì œëª© ì„¤ì •
            document.getElementById('dateDetailTitle').textContent = `${month}ì›” ${day}ì¼ (${dayName}) - ì´ ${daySchedules.length}ê±´`;
            
            // ë‚´ìš© ë Œë”ë§
            const contentEl = document.getElementById('dateDetailContent');
            contentEl.innerHTML = '';
            
            if (daySchedules.length === 0) {
                contentEl.innerHTML = '<div style="padding: 40px; text-align: center; color: #999;">ì´ ë‚ ì§œì— ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                // ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë ¬
                daySchedules.sort((a, b) => a.time.localeCompare(b.time));
                
                daySchedules.forEach(schedule => {
                    const scheduleCard = document.createElement('div');
                    scheduleCard.style.cssText = `
                        background: #f9f9f9;
                        border-left: 4px solid #2196F3;
                        padding: 15px;
                        margin-bottom: 10px;
                        border-radius: 6px;
                    `;
                    
                    const statusConfig = {
                        'unconfirmed': { color: '#ff5252', icon: 'ğŸ”´', text: 'ë¯¸í™•ì¸' },
                        'confirmed': { color: '#ff9800', icon: 'ğŸŸ¡', text: 'í™•ì¸ ì™„ë£Œ' },
                        'completed': { color: '#4caf50', icon: 'ğŸŸ¢', text: 'ì°¸ì„ ì™„ë£Œ' }
                    };
                    
                    const status = statusConfig[schedule.status];
                    const displayName = schedule.freelancer === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : schedule.freelancer;
                    
                    // ì‹œê°„ ê¸°ë¡ HTML ìƒì„±
                    let timeLogHTML = '';
                    if (schedule.timeLog && schedule.timeLog.endTime) {
                        const totalMinutes = schedule.timeLog.totalWorkMinutes || 0;
                        const hours = Math.floor(totalMinutes / 60);
                        const minutes = totalMinutes % 60;
                        
                        // ì‹œê°„ì„ 00ì‹œ 00ë¶„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                        const formatTime = (timeStr) => {
                            const [h, m] = timeStr.split(':');
                            return `${h}ì‹œ ${m}ë¶„`;
                        };
                        
                        const breakInfo = schedule.timeLog.breaks && schedule.timeLog.breaks.length > 0 ?
                            schedule.timeLog.breaks.map(b => {
                                if (b.start === 'ì •íšŒ') {
                                    return `${b.end}`;
                                }
                                return `${formatTime(b.start)} ~ ${formatTime(b.end)}`;
                            }).join(', ') : 'ì—†ìŒ';
                        
                        timeLogHTML = `
                            <div style="background: #e8f5e9; border-radius: 6px; padding: 10px; margin-top: 10px;">
                                <div style="font-weight: bold; color: #2e7d32; margin-bottom: 5px;">â±ï¸ ì‹¤ì œ ê·¼ë¬´ì‹œê°„</div>
                                <div style="font-size: 12px; color: #555; line-height: 1.5;">
                                    ${formatTime(schedule.timeLog.startTime)} ~ ${formatTime(schedule.timeLog.endTime)}
                                    <br>ì •íšŒ: ${breakInfo}
                                    <br><strong style="color: #1976d2;">ì´ ${hours}ì‹œê°„ ${minutes}ë¶„</strong>
                                </div>
                            </div>
                        `;
                    }
                    
                    scheduleCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: #333; font-size: 16px; margin-bottom: 5px;">
                                    ${schedule.title}
                                </div>
                                <div style="color: #666; font-size: 14px; display: flex; gap: 15px; flex-wrap: wrap;">
                                    <span>â° ${schedule.time}</span>
                                    <span>ğŸ‘¤ ${displayName}</span>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span style="
                                    background: ${status.color}20;
                                    color: ${status.color};
                                    padding: 4px 12px;
                                    border-radius: 12px;
                                    font-size: 12px;
                                    font-weight: bold;
                                ">${status.icon} ${status.text}</span>
                            </div>
                        </div>
                        ${schedule.memo ? `<div style="color: #666; font-size: 13px; margin-top: 8px; padding-top: 8px; border-top: 1px solid #e0e0e0;">ğŸ“ ${schedule.memo}</div>` : ''}
                        ${timeLogHTML}
                        ${currentView === 'admin' ? `
                            <div style="display: flex; gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e0e0;">
                                <button class="btn btn-outline" onclick="closeDateDetailModal(); openEditScheduleModal(${schedule.id})" style="flex: 1; font-size: 12px; padding: 6px;">âœï¸ ìˆ˜ì •</button>
                                <button class="btn btn-outline" onclick="deleteSchedule(${schedule.id})" style="flex: 1; font-size: 12px; padding: 6px; color: #f44336; border-color: #f44336;">ğŸ—‘ï¸ ì‚­ì œ</button>
                            </div>
                        ` : ''}
                    `;
                    
                    contentEl.appendChild(scheduleCard);
                });
            }
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('dateDetailModal').classList.add('show');
        }

        // ë‚ ì§œ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
        function closeDateDetailModal() {
            document.getElementById('dateDetailModal').classList.remove('show');
        }

        // ì¼ì • ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        function openEditScheduleModal(id) {
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) return;
            
            // í˜„ì¬ ê°’ ì„¤ì •
            document.getElementById('editScheduleIdField').value = id;
            document.getElementById('editScheduleTitle').value = schedule.title;
            document.getElementById('editScheduleDate').value = schedule.date;
            document.getElementById('editScheduleMemo').value = schedule.memo || '';
            
            // ì†ê¸°ì‚¬ ëª©ë¡ ë¡œë“œ
            const freelancerSelect = document.getElementById('editScheduleFreelancer');
            freelancerSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            
            const approvedFreelancers = Object.entries(accounts)
                .filter(([id, user]) => user.role === 'freelancer' && user.approved)
                .map(([id, user]) => ({ id, name: user.name }));
            
            approvedFreelancers.forEach(freelancer => {
                const option = document.createElement('option');
                option.value = freelancer.id;
                option.textContent = freelancer.name;
                if (freelancer.id === schedule.freelancer) {
                    option.selected = true;
                }
                freelancerSelect.appendChild(option);
            });
            
            // ì‹œê°„ ì˜µì…˜ ìƒì„±
            const timeSelect = document.getElementById('editScheduleTime');
            timeSelect.innerHTML = '<option value="">ì‹œê°„ ì„ íƒ</option>';
            
            for (let h = 6; h <= 23; h++) {
                for (let m = 0; m < 60; m += 30) {
                    const time = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
                    const option = document.createElement('option');
                    option.value = time;
                    option.textContent = time;
                    if (time === schedule.time) {
                        option.selected = true;
                    }
                    timeSelect.appendChild(option);
                }
            }
            
            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('editScheduleModal').classList.add('show');
        }

        // ì¼ì • ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditScheduleModal() {
            document.getElementById('editScheduleModal').classList.remove('show');
        }

        // ì¼ì • ìˆ˜ì • ì €ì¥
        function updateSchedule(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editScheduleIdField').value);
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) return;
            
            // ìˆ˜ì •ëœ ê°’ ì ìš©
            schedule.title = document.getElementById('editScheduleTitle').value;
            schedule.date = document.getElementById('editScheduleDate').value;
            schedule.time = document.getElementById('editScheduleTime').value;
            schedule.freelancer = document.getElementById('editScheduleFreelancer').value;
            schedule.memo = document.getElementById('editScheduleMemo').value;
            
            saveSchedules();
            closeEditScheduleModal();
            alert('ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
            if (currentView === 'admin') {
                renderTodaySchedules();
                renderCalendar();
                renderScheduleList();
            }
        }

        // ì¼ì • ì‚­ì œ
        async function deleteSchedule(id) {
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) return;
            
            const displayName = schedule.freelancer === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : schedule.freelancer;
            
            if (!confirm(`ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${schedule.title}\n${schedule.date} ${schedule.time}\në‹´ë‹¹: ${displayName}`)) {
                return;
            }
            
            // Firebaseì—ì„œ ì‚­ì œ
            if (schedule.firestoreId) {
                try {
                    await deleteDoc(doc(db, 'schedules', schedule.firestoreId));
                    console.log('âœ… Firebaseì—ì„œ ì¼ì • ì‚­ì œ ì™„ë£Œ');
                } catch (error) {
                    console.error('Firebase ì‚­ì œ ì˜¤ë¥˜:', error);
                }
            }
            
            // ë¡œì»¬ ë°°ì—´ì—ì„œ ì‚­ì œ
            schedules = schedules.filter(s => s.id !== id);
            
            alert('ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
            if (currentView === 'admin') {
                renderTodaySchedules();
                renderCalendar();
                renderScheduleList();
            }
            
            // ë‚ ì§œ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
            closeDateDetailModal();
        }

        // ì¼ì • ëª©ë¡ ë Œë”ë§
        function renderScheduleList() {
            const listEl = document.getElementById('adminScheduleList');
            listEl.innerHTML = '';

            let filteredSchedules = schedules;
            
            // ë‚ ì§œ ë²”ìœ„ í•„í„° ì ìš©
            if (dateRangeFilter.type !== 'all') {
                filteredSchedules = filteredSchedules.filter(s => {
                    return s.date >= dateRangeFilter.startDate && s.date <= dateRangeFilter.endDate;
                });
            }
            
            // í”„ë¦¬ëœì„œ í•„í„° ì ìš©
            if (selectedFreelancer) {
                filteredSchedules = filteredSchedules.filter(s => s.freelancer === selectedFreelancer);
            }
            
            // ìƒíƒœ í•„í„° ì ìš©
            if (currentFilter !== 'all') {
                filteredSchedules = filteredSchedules.filter(s => s.status === currentFilter);
            }

            // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
            const schedulesByDate = {};
            filteredSchedules.forEach(schedule => {
                if (!schedulesByDate[schedule.date]) {
                    schedulesByDate[schedule.date] = [];
                }
                schedulesByDate[schedule.date].push(schedule);
            });

            // ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedDates = Object.keys(schedulesByDate).sort();

            if (sortedDates.length === 0) {
                listEl.innerHTML = '<div style="padding: 40px; text-align: center; color: #999;">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                updateStats();
                return;
            }

            // ë‚ ì§œë³„ë¡œ ì•„ì½”ë””ì–¸ ìƒì„±
            sortedDates.forEach((dateStr, dateIndex) => {
                const date = new Date(dateStr);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                const dayName = dayNames[date.getDay()];
                
                const daySchedules = schedulesByDate[dateStr];
                // ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë ¬
                daySchedules.sort((a, b) => a.time.localeCompare(b.time));

                const accordionId = `accordion-${dateStr}`;
                const isExpanded = dateIndex === 0; // ì²« ë²ˆì§¸ë§Œ ê¸°ë³¸ í¼ì¹¨

                // ì•„ì½”ë””ì–¸ ì»¨í…Œì´ë„ˆ
                const accordionContainer = document.createElement('div');
                accordionContainer.style.cssText = `
                    margin-bottom: 10px;
                    margin-top: ${dateIndex > 0 ? '10px' : '0'};
                `;

                // ë‚ ì§œ í—¤ë” (í´ë¦­ ê°€ëŠ¥)
                const dateHeader = document.createElement('div');
                dateHeader.style.cssText = `
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 14px 16px;
                    border-radius: 8px;
                    font-weight: bold;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    cursor: pointer;
                    transition: all 0.2s;
                    user-select: none;
                `;
                
                dateHeader.onmouseover = function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';
                };
                dateHeader.onmouseout = function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                };

                dateHeader.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span id="arrow-${accordionId}" style="font-size: 18px; transition: transform 0.3s;">${isExpanded ? 'â–¼' : 'â–¶'}</span>
                        <span>${month}ì›” ${day}ì¼ (${dayName})</span>
                    </div>
                    <span style="background: rgba(255,255,255,0.3); padding: 4px 12px; border-radius: 12px; font-size: 13px;">${daySchedules.length}ê±´</span>
                `;

                // í…Œì´ë¸” ì»¨í…Œì´ë„ˆ
                const tableContainer = document.createElement('div');
                tableContainer.id = accordionId;
                tableContainer.style.cssText = `
                    display: ${isExpanded ? 'block' : 'none'};
                    margin-top: 10px;
                    animation: ${isExpanded ? 'slideDown 0.3s ease-out' : ''};
                `;

                // í…Œì´ë¸” ìƒì„±
                const table = document.createElement('div');
                table.style.cssText = `
                    background: white;
                    border: 1px solid #e0e0e0;
                    border-radius: 8px;
                    overflow: hidden;
                `;

                // í…Œì´ë¸” í—¤ë”
                const tableHeader = document.createElement('div');
                tableHeader.style.cssText = `
                    display: grid;
                    grid-template-columns: 70px 2fr 1fr 100px 140px;
                    gap: 10px;
                    padding: 12px 16px;
                    background: #f5f5f5;
                    font-weight: bold;
                    font-size: 13px;
                    color: #666;
                    border-bottom: 2px solid #e0e0e0;
                `;
                tableHeader.innerHTML = `
                    <div>ì‹œê°„</div>
                    <div>íšŒì˜ëª…</div>
                    <div>ì†ê¸°ì‚¬</div>
                    <div>ìƒíƒœ</div>
                    <div style="text-align: center;">ì‘ì—…</div>
                `;
                table.appendChild(tableHeader);

                // í…Œì´ë¸” ë³¸ë¬¸
                daySchedules.forEach((schedule, index) => {
                    const statusConfig = {
                        'unconfirmed': { color: '#ff5252', icon: 'ğŸ”´', text: 'ë¯¸í™•ì¸' },
                        'confirmed': { color: '#ff9800', icon: 'ğŸŸ¡', text: 'í™•ì¸ì™„ë£Œ' },
                        'completed': { color: '#4caf50', icon: 'ğŸŸ¢', text: 'ì°¸ì„ì™„ë£Œ' }
                    };
                    const status = statusConfig[schedule.status];
                    const displayName = schedule.freelancer === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : schedule.freelancer;

                    const row = document.createElement('div');
                    row.style.cssText = `
                        display: grid;
                        grid-template-columns: 70px 2fr 1fr 100px 140px;
                        gap: 10px;
                        padding: 14px 16px;
                        align-items: center;
                        border-bottom: 1px solid #f0f0f0;
                        transition: background 0.2s;
                        cursor: pointer;
                    `;
                    
                    if (index === daySchedules.length - 1) {
                        row.style.borderBottom = 'none';
                    }

                    row.onmouseover = function() {
                        this.style.background = '#f9f9f9';
                    };
                    row.onmouseout = function() {
                        this.style.background = 'white';
                    };

                    row.innerHTML = `
                        <div style="font-weight: 600; color: #333;">${schedule.time}</div>
                        <div>
                            <div style="font-weight: 500; color: #333; margin-bottom: 4px;">${schedule.title}</div>
                            ${schedule.memo ? `<div style="font-size: 12px; color: #999;">ğŸ“ ${schedule.memo}</div>` : ''}
                        </div>
                        <div style="color: #666;">${displayName}</div>
                        <div>
                            <span style="
                                background: ${status.color}15;
                                color: ${status.color};
                                padding: 4px 8px;
                                border-radius: 12px;
                                font-size: 11px;
                                font-weight: 600;
                                white-space: nowrap;
                            ">${status.icon} ${status.text}</span>
                        </div>
                        <div style="display: flex; gap: 6px; justify-content: center;">
                            <button class="btn btn-outline" onclick="event.stopPropagation(); openEditScheduleModal(${schedule.id})" style="font-size: 11px; padding: 5px 10px;">ìˆ˜ì •</button>
                            <button class="btn btn-outline" onclick="event.stopPropagation(); deleteSchedule(${schedule.id})" style="font-size: 11px; padding: 5px 10px; color: #f44336; border-color: #f44336;">ì‚­ì œ</button>
                        </div>
                    `;

                    table.appendChild(row);
                });

                tableContainer.appendChild(table);

                // í´ë¦­ ì´ë²¤íŠ¸ - ì•„ì½”ë””ì–¸ í† ê¸€
                dateHeader.onclick = function() {
                    const isCurrentlyExpanded = tableContainer.style.display === 'block';
                    const arrow = document.getElementById(`arrow-${accordionId}`);
                    
                    if (isCurrentlyExpanded) {
                        tableContainer.style.display = 'none';
                        arrow.textContent = 'â–¶';
                    } else {
                        tableContainer.style.display = 'block';
                        tableContainer.style.animation = 'slideDown 0.3s ease-out';
                        arrow.textContent = 'â–¼';
                    }
                };

                accordionContainer.appendChild(dateHeader);
                accordionContainer.appendChild(tableContainer);
                listEl.appendChild(accordionContainer);
            });

            updateStats();
        }

        // í”„ë¦¬ëœì„œ ì¼ì • ë¡œë“œ
        function loadFreelancerSchedules() {
            const listEl = document.getElementById('freelancerScheduleList');
            listEl.innerHTML = '';

            // í”„ë¦¬ëœì„œëŠ” ë¬´ì¡°ê±´ ë³¸ì¸ ì¼ì •ë§Œ
            const username = currentUser.username;
            const mySchedules = schedules.filter(s => s.freelancer === username);

            mySchedules.forEach(schedule => {
                const item = document.createElement('div');
                item.className = 'schedule-item';
                
                const today = new Date().toISOString().split('T')[0];
                const isToday = schedule.date === today;
                const ongoing = ongoingMeetings[schedule.id];

                let actionButtonsHTML = '';
                let timeLogHTML = '';

                // íšŒì˜ ì‹œê°„ ê¸°ë¡ì´ ì™„ë£Œëœ ê²½ìš°
                if (schedule.timeLog && schedule.timeLog.endTime) {
                    const totalMinutes = schedule.timeLog.totalWorkMinutes || 0;
                    const hours = Math.floor(totalMinutes / 60);
                    const minutes = totalMinutes % 60;
                    
                    // ì‹œê°„ì„ 00ì‹œ 00ë¶„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    const formatTime = (timeStr) => {
                        const [h, m] = timeStr.split(':');
                        return `${h}ì‹œ ${m}ë¶„`;
                    };
                    
                    const breakInfo = schedule.timeLog.breaks && schedule.timeLog.breaks.length > 0 ?
                        schedule.timeLog.breaks.map(b => {
                            if (b.start === 'ì •íšŒ') {
                                return `${b.end}`;
                            }
                            return `${formatTime(b.start)} ~ ${formatTime(b.end)}`;
                        }).join(', ') : 'ì—†ìŒ';
                    
                    timeLogHTML = `
                        <div style="background: #e8f5e9; border: 1px solid #4caf50; border-radius: 6px; padding: 12px; margin-top: 10px;">
                            <div style="font-weight: bold; color: #2e7d32; margin-bottom: 8px;">â±ï¸ íšŒì˜ ì‹œê°„ ê¸°ë¡</div>
                            <div style="font-size: 13px; color: #333; line-height: 1.6;">
                                <div>â€¢ ì‹œì‘: ${formatTime(schedule.timeLog.startTime)}</div>
                                <div>â€¢ ì¢…ë£Œ: ${formatTime(schedule.timeLog.endTime)}</div>
                                <div>â€¢ ì •íšŒ: ${breakInfo}</div>
                                <div style="margin-top: 8px; font-weight: bold; color: #1976d2;">
                                    â€¢ ì‹¤ì œ ê·¼ë¬´ì‹œê°„: ${hours}ì‹œê°„ ${minutes}ë¶„
                                </div>
                            </div>
                            <button class="btn btn-outline" onclick="editTimeLog(${schedule.id})" style="margin-top: 8px; font-size: 12px; padding: 6px 12px;">ìˆ˜ì •</button>
                        </div>
                    `;
                    actionButtonsHTML = `<span style="color: #4CAF50;">âœ”ï¸âœ”ï¸ ì°¸ì„ ì™„ë£Œ</span>`;
                }
                // ì§„í–‰ ì¤‘ì¸ íšŒì˜
                else if (ongoing) {
                    const now = new Date();
                    const startTime = new Date(ongoing.startTime);
                    const elapsedMinutes = Math.floor((now - startTime) / 60000);
                    
                    if (ongoing.isPaused) {
                        const pauseStart = ongoing.breaks[ongoing.breaks.length - 1].start;
                        timeLogHTML = `
                            <div style="background: #fff9c4; border: 1px solid #fbc02d; border-radius: 6px; padding: 10px; margin-top: 10px;">
                                <div style="font-weight: bold; color: #f57c00;">ğŸŸ¡ ì •íšŒ ì¤‘</div>
                                <div style="font-size: 13px; color: #666; margin-top: 5px;">ì •íšŒ ì‹œì‘: ${pauseStart}</div>
                            </div>
                        `;
                        actionButtonsHTML = `
                            <button class="btn btn-primary" onclick="resumeMeeting(${schedule.id})">â–¶ï¸ íšŒì˜ ì¬ê°œ</button>
                            <button class="btn btn-outline" onclick="endMeeting(${schedule.id})">â¹ï¸ íšŒì˜ ì¢…ë£Œ</button>
                        `;
                    } else {
                        timeLogHTML = `
                            <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 6px; padding: 10px; margin-top: 10px;">
                                <div style="font-weight: bold; color: #1976d2;">ğŸŸ¢ ì§„í–‰ ì¤‘</div>
                                <div style="font-size: 13px; color: #666; margin-top: 5px;">
                                    ì‹œì‘: ${ongoing.startTime.split(' ')[1]}<br>
                                    ê²½ê³¼: ${elapsedMinutes}ë¶„
                                </div>
                            </div>
                        `;
                        actionButtonsHTML = `
                            <button class="btn btn-secondary" onclick="pauseMeeting(${schedule.id})">â¸ï¸ ì •íšŒ ì‹œì‘</button>
                            <button class="btn btn-primary" onclick="endMeeting(${schedule.id})">â¹ï¸ íšŒì˜ ì¢…ë£Œ</button>
                        `;
                    }
                }
                // ì•„ì§ ì‹œì‘ ì•ˆ í•œ íšŒì˜
                else {
                    if (schedule.status === 'unconfirmed') {
                        actionButtonsHTML = `<button class="btn btn-secondary" onclick="confirmSchedule(${schedule.id})">âœ… ì¼ì • í™•ì¸</button>`;
                    } else if (schedule.status === 'confirmed' && isToday) {
                        actionButtonsHTML = `
                            <span style="color: #4CAF50; margin-right: 10px;">âœ… í™•ì¸ ì™„ë£Œ</span>
                            <button class="btn btn-primary" onclick="startMeeting(${schedule.id})">â–¶ï¸ íšŒì˜ ì‹œì‘</button>
                        `;
                    } else if (schedule.status === 'confirmed') {
                        actionButtonsHTML = `<span style="color: #4CAF50;">âœ… í™•ì¸ ì™„ë£Œ</span>`;
                    }
                }

                item.innerHTML = `
                    <div class="schedule-header">
                        <div class="schedule-title">${schedule.title}</div>
                    </div>
                    <div class="schedule-date">ğŸ“… ${schedule.date} ${schedule.time}</div>
                    ${schedule.memo ? `<div style="margin-top: 10px; color: #666; font-size: 14px;">ğŸ“ ${schedule.memo}</div>` : ''}
                    ${timeLogHTML}
                    <div class="action-buttons" style="margin-top: 12px;">
                        ${actionButtonsHTML}
                    </div>
                `;
                
                listEl.appendChild(item);
            });

            renderCalendar();
        }

        // ì¼ì • í™•ì¸
        function confirmSchedule(id) {
            const schedule = schedules.find(s => s.id === id);
            if (schedule) {
                schedule.status = 'confirmed';
                saveSchedules(); // ì¼ì • ì €ì¥
                alert('ì¼ì •ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤!');
                loadFreelancerSchedules();
            }
        }

        // íšŒì˜ ì‹œì‘
        function startMeeting(id) {
            if (!confirm('íšŒì˜ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit' });
            const dateTimeString = now.toLocaleString('ko-KR', { hour12: false });
            
            ongoingMeetings[id] = {
                startTime: dateTimeString,
                breaks: [],
                isPaused: false
            };
            
            alert(`íšŒì˜ ì‹œì‘: ${timeString}`);
            loadFreelancerSchedules();
        }

        // ì •íšŒ ì‹œì‘
        function pauseMeeting(id) {
            if (!confirm('ì •íšŒë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit' });
            
            ongoingMeetings[id].breaks.push({
                start: timeString,
                end: null
            });
            ongoingMeetings[id].isPaused = true;
            
            alert(`ì •íšŒ ì‹œì‘: ${timeString}`);
            loadFreelancerSchedules();
        }

        // íšŒì˜ ì¬ê°œ
        function resumeMeeting(id) {
            if (!confirm('íšŒì˜ë¥¼ ì¬ê°œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit' });
            
            const ongoing = ongoingMeetings[id];
            const lastBreak = ongoing.breaks[ongoing.breaks.length - 1];
            lastBreak.end = timeString;
            ongoing.isPaused = false;
            
            alert(`íšŒì˜ ì¬ê°œ: ${timeString}`);
            loadFreelancerSchedules();
        }

        // íšŒì˜ ì¢…ë£Œ
        function endMeeting(id) {
            if (!confirm('íšŒì˜ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì‹œê°„ ê¸°ë¡ì´ ì €ì¥ë©ë‹ˆë‹¤)')) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit' });
            const dateTimeString = now.toLocaleString('ko-KR', { hour12: false });
            
            const ongoing = ongoingMeetings[id];
            const schedule = schedules.find(s => s.id === id);
            
            // ì •íšŒ ì¤‘ì´ì—ˆìœ¼ë©´ ë§ˆì§€ë§‰ ì •íšŒ ì¢…ë£Œ ì‹œê°„ ê¸°ë¡
            if (ongoing.isPaused) {
                const lastBreak = ongoing.breaks[ongoing.breaks.length - 1];
                lastBreak.end = timeString;
            }
            
            // ì´ ì‹œê°„ ê³„ì‚°
            const startTime = new Date(ongoing.startTime);
            const endTime = now;
            const totalMinutes = Math.floor((endTime - startTime) / 60000);
            
            // ì •íšŒ ì‹œê°„ ê³„ì‚°
            let breakMinutes = 0;
            ongoing.breaks.forEach(br => {
                if (br.start && br.end) {
                    const breakStart = new Date(`${schedule.date} ${br.start}`);
                    const breakEnd = new Date(`${schedule.date} ${br.end}`);
                    breakMinutes += Math.floor((breakEnd - breakStart) / 60000);
                }
            });
            
            const workMinutes = totalMinutes - breakMinutes;
            
            // ì‹œê°„ ê¸°ë¡ ì €ì¥
            schedule.timeLog = {
                startTime: ongoing.startTime.split(' ')[1], // ì‹œê°„ë§Œ
                endTime: timeString,
                breaks: ongoing.breaks,
                totalMinutes: totalMinutes,
                totalWorkMinutes: workMinutes
            };
            schedule.status = 'completed';
            
            // ì§„í–‰ ì¤‘ ìƒíƒœ ì œê±°
            delete ongoingMeetings[id];
            
            saveSchedules();
            
            const hours = Math.floor(workMinutes / 60);
            const minutes = workMinutes % 60;
            alert(`íšŒì˜ ì¢…ë£Œ!\nì‹¤ì œ ê·¼ë¬´ì‹œê°„: ${hours}ì‹œê°„ ${minutes}ë¶„`);
            
            loadFreelancerSchedules();
        }

        // ì‹œê°„ ê¸°ë¡ ìˆ˜ì •
        function editTimeLog(id) {
            const schedule = schedules.find(s => s.id === id);
            if (!schedule || !schedule.timeLog) return;
            
            const timeLog = schedule.timeLog;
            
            // ëª¨ë‹¬ì— í˜„ì¬ ê°’ ì„¤ì •
            document.getElementById('editScheduleId').value = id;
            
            // ì‹œì‘ ì‹œê°„ íŒŒì‹±
            const startParts = timeLog.startTime.split(':');
            document.getElementById('editStartHour').value = startParts[0];
            document.getElementById('editStartMinute').value = startParts[1];
            
            // ì¢…ë£Œ ì‹œê°„ íŒŒì‹±
            const endParts = timeLog.endTime.split(':');
            document.getElementById('editEndHour').value = endParts[0];
            document.getElementById('editEndMinute').value = endParts[1];
            
            // ì •íšŒ ì‹œê°„ ê³„ì‚°
            let totalBreakMinutes = 0;
            if (timeLog.breaks && timeLog.breaks.length > 0) {
                timeLog.breaks.forEach(br => {
                    if (br.start && br.end) {
                        const breakStart = new Date(`${schedule.date} ${br.start}`);
                        const breakEnd = new Date(`${schedule.date} ${br.end}`);
                        totalBreakMinutes += Math.floor((breakEnd - breakStart) / 60000);
                    }
                });
            }
            document.getElementById('editBreakMinutes').value = totalBreakMinutes;
            
            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('editTimeLogModal').classList.add('show');
        }

        // ì‹œê°„ ê¸°ë¡ ìˆ˜ì • ì €ì¥
        function saveTimeLogEdit(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editScheduleId').value);
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) return;
            
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const startHour = String(document.getElementById('editStartHour').value).padStart(2, '0');
            const startMinute = String(document.getElementById('editStartMinute').value).padStart(2, '0');
            const endHour = String(document.getElementById('editEndHour').value).padStart(2, '0');
            const endMinute = String(document.getElementById('editEndMinute').value).padStart(2, '0');
            const breakMinutes = parseInt(document.getElementById('editBreakMinutes').value) || 0;
            
            const newStart = `${startHour}:${startMinute}`;
            const newEnd = `${endHour}:${endMinute}`;
            
            // ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬
            const startTime = new Date(`${schedule.date} ${newStart}`);
            const endTime = new Date(`${schedule.date} ${newEnd}`);
            
            if (endTime <= startTime) {
                alert('ì¢…ë£Œ ì‹œê°„ì´ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const totalMinutes = Math.floor((endTime - startTime) / 60000);
            
            if (breakMinutes >= totalMinutes) {
                alert('ì •íšŒ ì‹œê°„ì´ ì „ì²´ íšŒì˜ ì‹œê°„ë³´ë‹¤ ê¸¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì‹œê°„ ê¸°ë¡ ì—…ë°ì´íŠ¸
            schedule.timeLog.startTime = newStart;
            schedule.timeLog.endTime = newEnd;
            schedule.timeLog.totalMinutes = totalMinutes;
            schedule.timeLog.totalWorkMinutes = totalMinutes - breakMinutes;
            
            // ì •íšŒ ì •ë³´ ë‹¨ìˆœí™” (ì´ ì •íšŒ ì‹œê°„ë§Œ ì €ì¥)
            if (breakMinutes > 0) {
                schedule.timeLog.breaks = [{
                    start: 'ì •íšŒ',
                    end: `${breakMinutes}ë¶„`
                }];
            } else {
                schedule.timeLog.breaks = [];
            }
            
            saveSchedules();
            closeEditTimeLogModal();
            alert('ì‹œê°„ ê¸°ë¡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            loadFreelancerSchedules();
        }

        // ì‹œê°„ ê¸°ë¡ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditTimeLogModal() {
            document.getElementById('editTimeLogModal').classList.remove('show');
        }

        // ì°¸ì„ ì™„ë£Œ (ê¸°ì¡´ í•¨ìˆ˜ - ì‹œê°„ ê¸°ë¡ ì—†ì´ ì™„ë£Œë§Œ)
        function completeAttendance(id) {
            const schedule = schedules.find(s => s.id === id);
            if (schedule) {
                schedule.status = 'completed';
                saveSchedules(); // ì¼ì • ì €ì¥
                alert('ì°¸ì„ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadFreelancerSchedules();
            }
        }

        // í•„í„°ë§
        // ë‚ ì§œ ë²”ìœ„ ì„¤ì •
        function setDateRange(type) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('[id^="dateRange-"]').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (type === 'all') {
                dateRangeFilter = { type: 'all', startDate: null, endDate: null };
                document.getElementById('dateRange-all').classList.add('active');
                document.getElementById('dateRangeDisplay').textContent = '';
            }
            else if (type === 'today') {
                const todayStr = today.toISOString().split('T')[0];
                dateRangeFilter = { type: 'today', startDate: todayStr, endDate: todayStr };
                document.getElementById('dateRange-today').classList.add('active');
                document.getElementById('dateRangeDisplay').textContent = `ì˜¤ëŠ˜ (${today.getMonth() + 1}ì›” ${today.getDate()}ì¼)`;
            }
            else if (type === 'week') {
                // ì´ë²ˆ ì£¼ (ì›”ìš”ì¼ ~ ì¼ìš”ì¼)
                const dayOfWeek = today.getDay();
                const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // ì›”ìš”ì¼ ê¸°ì¤€
                
                const monday = new Date(today);
                monday.setDate(today.getDate() + diff);
                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
                
                dateRangeFilter = {
                    type: 'week',
                    startDate: monday.toISOString().split('T')[0],
                    endDate: sunday.toISOString().split('T')[0]
                };
                document.getElementById('dateRange-week').classList.add('active');
                document.getElementById('dateRangeDisplay').textContent = 
                    `ì´ë²ˆ ì£¼ (${monday.getMonth() + 1}/${monday.getDate()} ~ ${sunday.getMonth() + 1}/${sunday.getDate()})`;
            }
            else if (type === 'month') {
                // ì´ë²ˆ ë‹¬
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                
                dateRangeFilter = {
                    type: 'month',
                    startDate: firstDay.toISOString().split('T')[0],
                    endDate: lastDay.toISOString().split('T')[0]
                };
                document.getElementById('dateRange-month').classList.add('active');
                document.getElementById('dateRangeDisplay').textContent = 
                    `ì´ë²ˆ ë‹¬ (${today.getMonth() + 1}ì›” 1ì¼ ~ ${lastDay.getDate()}ì¼)`;
            }
            else if (type === 'custom') {
                const startDate = document.getElementById('customStartDate').value;
                const endDate = document.getElementById('customEndDate').value;
                
                if (!startDate || !endDate) {
                    alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                if (startDate > endDate) {
                    alert('ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                dateRangeFilter = { type: 'custom', startDate, endDate };
                
                const start = new Date(startDate);
                const end = new Date(endDate);
                document.getElementById('dateRangeDisplay').textContent = 
                    `ì‚¬ìš©ì ì§€ì • (${start.getMonth() + 1}/${start.getDate()} ~ ${end.getMonth() + 1}/${end.getDate()})`;
            }
            
            // ì¼ì • ëª©ë¡ ë‹¤ì‹œ ë Œë”ë§
            renderScheduleList();
        }

        function filterSchedules(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-section .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderScheduleList();
        }

        // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        function downloadExcel() {
            // í˜„ì¬ í•„í„°ë§ëœ ì¼ì • ê°€ì ¸ì˜¤ê¸°
            let filteredSchedules = schedules;
            
            // ë‚ ì§œ ë²”ìœ„ í•„í„° ì ìš©
            if (dateRangeFilter.type !== 'all') {
                filteredSchedules = filteredSchedules.filter(s => {
                    return s.date >= dateRangeFilter.startDate && s.date <= dateRangeFilter.endDate;
                });
            }
            
            // í”„ë¦¬ëœì„œ í•„í„° ì ìš©
            if (selectedFreelancer) {
                filteredSchedules = filteredSchedules.filter(s => s.freelancer === selectedFreelancer);
            }
            
            // ìƒíƒœ í•„í„° ì ìš©
            if (currentFilter !== 'all') {
                filteredSchedules = filteredSchedules.filter(s => s.status === currentFilter);
            }

            if (filteredSchedules.length === 0) {
                alert('ë‹¤ìš´ë¡œë“œí•  ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë‚ ì§œ ìˆœ ì •ë ¬
            filteredSchedules.sort((a, b) => {
                if (a.date !== b.date) return a.date.localeCompare(b.date);
                return a.time.localeCompare(b.time);
            });

            // ì—‘ì…€ ë°ì´í„° ìƒì„±
            const excelData = filteredSchedules.map(schedule => {
                const statusText = {
                    'unconfirmed': 'ë¯¸í™•ì¸',
                    'confirmed': 'í™•ì¸ì™„ë£Œ',
                    'completed': 'ì°¸ì„ì™„ë£Œ'
                };

                const displayName = schedule.freelancer === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : schedule.freelancer;

                const row = {
                    'ë‚ ì§œ': schedule.date,
                    'ì‹œê°„': schedule.time,
                    'íšŒì˜ëª…': schedule.title,
                    'ì†ê¸°ì‚¬': displayName,
                    'ìƒíƒœ': statusText[schedule.status]
                };

                // ì‹œê°„ ê¸°ë¡ì´ ìˆìœ¼ë©´ ì¶”ê°€
                if (schedule.timeLog && schedule.timeLog.endTime) {
                    const totalMinutes = schedule.timeLog.totalWorkMinutes || 0;
                    const hours = Math.floor(totalMinutes / 60);
                    const minutes = totalMinutes % 60;

                    row['íšŒì˜ ì‹œì‘'] = schedule.timeLog.startTime;
                    row['íšŒì˜ ì¢…ë£Œ'] = schedule.timeLog.endTime;
                    
                    // ì •íšŒ ì‹œê°„
                    let breakInfo = 'ì—†ìŒ';
                    if (schedule.timeLog.breaks && schedule.timeLog.breaks.length > 0) {
                        const breakMinutes = schedule.timeLog.totalMinutes - schedule.timeLog.totalWorkMinutes;
                        if (breakMinutes > 0) {
                            breakInfo = `${breakMinutes}ë¶„`;
                        }
                    }
                    row['ì •íšŒì‹œê°„'] = breakInfo;
                    row['ì‹¤ê·¼ë¬´ì‹œê°„'] = `${hours}ì‹œê°„ ${minutes}ë¶„`;
                } else {
                    row['íšŒì˜ ì‹œì‘'] = '-';
                    row['íšŒì˜ ì¢…ë£Œ'] = '-';
                    row['ì •íšŒì‹œê°„'] = '-';
                    row['ì‹¤ê·¼ë¬´ì‹œê°„'] = '-';
                }

                if (schedule.memo) {
                    row['ë©”ëª¨'] = schedule.memo;
                }

                return row;
            });

            // ì›Œí¬ë¶ ìƒì„±
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(excelData);

            // ì—´ ë„ˆë¹„ ì„¤ì •
            ws['!cols'] = [
                { wch: 12 },  // ë‚ ì§œ
                { wch: 8 },   // ì‹œê°„
                { wch: 20 },  // íšŒì˜ëª…
                { wch: 10 },  // ì†ê¸°ì‚¬
                { wch: 10 },  // ìƒíƒœ
                { wch: 10 },  // íšŒì˜ ì‹œì‘
                { wch: 10 },  // íšŒì˜ ì¢…ë£Œ
                { wch: 10 },  // ì •íšŒì‹œê°„
                { wch: 12 },  // ì‹¤ê·¼ë¬´ì‹œê°„
                { wch: 30 }   // ë©”ëª¨
            ];

            XLSX.utils.book_append_sheet(wb, ws, 'ì¼ì • ëª©ë¡');

            // íŒŒì¼ëª… ìƒì„±
            const today = new Date();
            const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            let filename = `ì†ê¸°ì‚¬_ì¼ì •_${dateStr}`;
            if (dateRangeFilter.type !== 'all') {
                filename += `_${dateRangeFilter.type}`;
            }
            if (selectedFreelancer) {
                const freelancerName = selectedFreelancer === 'ë°•í˜•ê·œF' ? 'ë°•í˜•ê·œ' : selectedFreelancer;
                filename += `_${freelancerName}`;
            }
            filename += '.xlsx';

            // ë‹¤ìš´ë¡œë“œ
            XLSX.writeFile(wb, filename);
            
            alert(`${filteredSchedules.length}ê±´ì˜ ì¼ì •ì„ ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);
        }

        // ì¼ì • ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        // ì¼ì • ìˆ˜ì • ëª¨ë‹¬ì˜ í”„ë¦¬ëœì„œ ì˜µì…˜ ë¡œë“œ
        function loadEditFreelancerOptions() {
            const select = document.getElementById('editScheduleFreelancer');
            const approvedFreelancers = Object.entries(accounts)
                .filter(([id, user]) => user.role === 'freelancer' && user.approved)
                .map(([id, user]) => ({ id, name: user.name }));
            
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            approvedFreelancers.forEach(freelancer => {
                const option = document.createElement('option');
                option.value = freelancer.id;
                option.textContent = freelancer.name;
                select.appendChild(option);
            });
        }

        // ì¼ì • ìˆ˜ì • ì €ì¥
        function saveScheduleEdit(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editScheduleIdField').value);
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) return;
            
            // ìˆ˜ì •ëœ ê°’ ê°€ì ¸ì˜¤ê¸°
            const hour = String(document.getElementById('editScheduleHour').value).padStart(2, '0');
            const minute = String(document.getElementById('editScheduleMinute').value).padStart(2, '0');
            
            schedule.freelancer = document.getElementById('editScheduleFreelancer').value;
            schedule.title = document.getElementById('editScheduleTitle').value;
            schedule.date = document.getElementById('editScheduleDate').value;
            schedule.time = `${hour}:${minute}`;
            schedule.memo = document.getElementById('editScheduleMemo').value;
            
            saveSchedules();
            closeEditScheduleModal();
            
            alert('ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // í™”ë©´ ê°±ì‹ 
            if (selectedFreelancer) {
                updateFreelancerSummary();
            }
            renderTodaySchedules();
            renderCalendar();
            renderScheduleList();
            updateStats();
        }

        // ì¼ì • ì‚­ì œ (ì¤‘ë³µ ì œê±°ë¨ - ìœ„ì˜ deleteSchedule í•¨ìˆ˜ ì‚¬ìš©)

        // ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ ëª©ë¡ ë¡œë“œ
        function loadFreelancerOptions() {
            const scheduleSelect = document.getElementById('scheduleFreelancer');
            const adminSelect = document.getElementById('adminFreelancerSelect');
            
            // ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ë§Œ í•„í„°ë§
            const approvedFreelancers = Object.entries(accounts)
                .filter(([id, user]) => user.role === 'freelancer' && user.approved)
                .map(([id, user]) => ({ id, name: user.name }));
            
            // ì¼ì • ë“±ë¡ ëª¨ë‹¬ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            if (scheduleSelect) {
                scheduleSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
                approvedFreelancers.forEach(freelancer => {
                    const option = document.createElement('option');
                    option.value = freelancer.id;
                    option.textContent = freelancer.name;
                    scheduleSelect.appendChild(option);
                });
            }
            
            // ê´€ë¦¬ì í•„í„° ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            if (adminSelect) {
                const currentValue = adminSelect.value;
                adminSelect.innerHTML = '<option value="">ì „ì²´ ë³´ê¸°</option>';
                approvedFreelancers.forEach(freelancer => {
                    const option = document.createElement('option');
                    option.value = freelancer.id;
                    option.textContent = freelancer.name;
                    adminSelect.appendChild(option);
                });
                // ì´ì „ì— ì„ íƒëœ ê°’ ìœ ì§€
                if (currentValue) {
                    adminSelect.value = currentValue;
                }
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            let statsSchedules = schedules;
            
            // í”„ë¦¬ëœì„œ í•„í„° ì ìš©
            if (selectedFreelancer) {
                statsSchedules = schedules.filter(s => s.freelancer === selectedFreelancer);
            }
            
            document.getElementById('totalSchedules').textContent = statsSchedules.length;
            document.getElementById('unconfirmedCount').textContent = statsSchedules.filter(s => s.status === 'unconfirmed').length;
            document.getElementById('confirmedCount').textContent = statsSchedules.filter(s => s.status === 'confirmed').length;
            document.getElementById('completedCount').textContent = statsSchedules.filter(s => s.status === 'completed').length;
        }

        // í”„ë¦¬ëœì„œ ì„ íƒ ì‹œ ìë™ì™„ì„± ì—…ë°ì´íŠ¸
        function updateFreelancerSuggestions() {
            const freelancer = document.getElementById('scheduleFreelancer').value;
            const meetingList = document.getElementById('meetingList');
            
            // ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
            meetingList.innerHTML = '';
            
            if (freelancer && freelancerHistory[freelancer]) {
                // íšŒì˜ëª… ìë™ì™„ì„±
                freelancerHistory[freelancer].meetings.forEach(meeting => {
                    const option = document.createElement('option');
                    option.value = meeting;
                    meetingList.appendChild(option);
                });
            }
        }

        // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
        function openAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.add('show');
            
            // ì´ˆê¸°í™”
            selectedDates = [];
            dateTimePairs = {};
            bulkDate = new Date();
            
            // ìŠ¹ì¸ëœ ì†ê¸°ì‚¬ ëª©ë¡ ë¡œë“œ
            loadFreelancerOptions();
            
            // ë‚ ì§œ ì„ íƒ ìº˜ë¦°ë” ë Œë”ë§
            renderBulkDateSelector();
            updateSelectedDatesDisplay();
        }

        // ì¼ê´„ ë“±ë¡ ë‚ ì§œ ì„ íƒ ìº˜ë¦°ë” ë Œë”ë§
        function renderBulkDateSelector() {
            const year = bulkDate.getFullYear();
            const month = bulkDate.getMonth();
            
            document.getElementById('bulkMonthDisplay').textContent = `${year}ë…„ ${month + 1}ì›”`;
            
            const gridEl = document.getElementById('bulkDateSelector');
            gridEl.innerHTML = '';
            
            // ìš”ì¼ í—¤ë”
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.style.cssText = 'text-align: center; font-weight: bold; color: #666; font-size: 12px; padding: 5px;';
                header.textContent = day;
                gridEl.appendChild(header);
            });
            
            // ë‚ ì§œ ê³„ì‚°
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            // ë¹ˆ ì¹¸
            for (let i = 0; i < firstDay; i++) {
                gridEl.appendChild(document.createElement('div'));
            }
            
            // ë‚ ì§œ ë²„íŠ¼
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const isSelected = selectedDates.includes(dateStr);
                
                const dateBtn = document.createElement('div');
                dateBtn.style.cssText = `
                    padding: 8px;
                    text-align: center;
                    border: 2px solid ${isSelected ? '#4CAF50' : '#ddd'};
                    background: ${isSelected ? '#e8f5e9' : 'white'};
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                    transition: all 0.2s;
                `;
                dateBtn.textContent = date;
                dateBtn.onclick = () => toggleDateSelection(dateStr);
                
                dateBtn.onmouseover = function() {
                    if (!isSelected) {
                        this.style.background = '#f5f5f5';
                    }
                };
                dateBtn.onmouseout = function() {
                    if (!isSelected) {
                        this.style.background = 'white';
                    }
                };
                
                gridEl.appendChild(dateBtn);
            }
        }

        // ë‚ ì§œ ì„ íƒ/í•´ì œ í† ê¸€
        function toggleDateSelection(dateStr) {
            const index = selectedDates.indexOf(dateStr);
            if (index > -1) {
                selectedDates.splice(index, 1);
                delete dateTimePairs[dateStr];
            } else {
                selectedDates.push(dateStr);
                selectedDates.sort();
                // ê¸°ë³¸ ì‹œê°„ ì„¤ì • (ë¹„ì–´ìˆìŒ)
                dateTimePairs[dateStr] = '';
            }
            
            renderBulkDateSelector();
            updateSelectedDatesDisplay();
            renderTimeSettings();
        }

        // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSelectedDatesDisplay() {
            const displayEl = document.getElementById('selectedDatesDisplay');
            if (selectedDates.length === 0) {
                displayEl.textContent = 'ì—†ìŒ';
                displayEl.style.color = '#999';
            } else {
                displayEl.textContent = selectedDates.map(d => {
                    const date = new Date(d);
                    return `${date.getMonth() + 1}/${date.getDate()}`;
                }).join(', ') + ` (${selectedDates.length}ê°œ)`;
                displayEl.style.color = '#4CAF50';
                displayEl.style.fontWeight = 'bold';
            }
        }

        // ë‚ ì§œë³„ ì‹œê°„ ì„¤ì • UI ë Œë”ë§
        function renderTimeSettings() {
            const container = document.getElementById('timeSettingsContainer');
            const listEl = document.getElementById('timeSettingsList');
            
            if (selectedDates.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            listEl.innerHTML = '';
            
            selectedDates.forEach(dateStr => {
                const date = new Date(dateStr);
                const dateLabel = `${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
                
                const timeRow = document.createElement('div');
                timeRow.style.cssText = 'display: flex; align-items: center; gap: 10px; margin-bottom: 10px; padding: 10px; background: white; border-radius: 6px;';
                
                timeRow.innerHTML = `
                    <div style="flex: 1; font-weight: 500; color: #333;">${dateLabel}</div>
                    <select onchange="updateDateTime('${dateStr}', this.value)" required style="flex: 2; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="">ì‹œê°„ ì„ íƒ</option>
                        ${generateTimeOptions(dateStr)}
                    </select>
                `;
                
                listEl.appendChild(timeRow);
            });
        }

        // ì‹œê°„ ì˜µì…˜ ìƒì„± (30ë¶„ ë‹¨ìœ„)
        function generateTimeOptions(dateStr) {
            let options = '';
            const currentTime = dateTimePairs[dateStr] || '';
            
            for (let h = 6; h <= 23; h++) {
                for (let m = 0; m < 60; m += 30) {
                    const time = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
                    const selected = time === currentTime ? 'selected' : '';
                    options += `<option value="${time}" ${selected}>${time}</option>`;
                }
            }
            return options;
        }

        // ë‚ ì§œë³„ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateDateTime(dateStr, time) {
            dateTimePairs[dateStr] = time;
        }

        // ì¼ê´„ ë“±ë¡ ì›” ë³€ê²½
        function changeBulkMonth(delta) {
            bulkDate.setMonth(bulkDate.getMonth() + delta);
            renderBulkDateSelector();
        }

        function closeAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.remove('show');
            // ì´ˆê¸°í™”
            selectedDates = [];
            dateTimePairs = {};
            document.getElementById('timeSettingsContainer').style.display = 'none';
            document.getElementById('meetingList').innerHTML = '';
        }

        // ì¼ì • ì¶”ê°€
        function addSchedule(event) {
            event.preventDefault();
            
            const freelancer = document.getElementById('scheduleFreelancer').value;
            const title = document.getElementById('scheduleTitle').value;
            const memo = document.getElementById('scheduleMemo').value;
            
            // ë‚ ì§œ ì„ íƒ í™•ì¸
            if (selectedDates.length === 0) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ëª¨ë“  ë‚ ì§œì— ì‹œê°„ì´ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
            for (let dateStr of selectedDates) {
                if (!dateTimePairs[dateStr]) {
                    alert(`${dateStr} ë‚ ì§œì˜ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.`);
                    return;
                }
            }
            
            // ê° ë‚ ì§œë³„ë¡œ ì¼ì • ìƒì„±
            let addedCount = 0;
            selectedDates.forEach(dateStr => {
                const newSchedule = {
                    id: schedules.length + 1 + addedCount,
                    title: title,
                    date: dateStr,
                    time: dateTimePairs[dateStr],
                    freelancer: freelancer,
                    status: 'unconfirmed',
                    memo: memo
                };
                
                schedules.push(newSchedule);
                addedCount++;
                
                // í”„ë¦¬ëœì„œ íˆìŠ¤í† ë¦¬ ìë™ ì—…ë°ì´íŠ¸
                if (!freelancerHistory[freelancer]) {
                    freelancerHistory[freelancer] = {
                        meetings: [],
                        times: []
                    };
                }
                
                if (!freelancerHistory[freelancer].meetings.includes(title)) {
                    freelancerHistory[freelancer].meetings.push(title);
                }
                if (!freelancerHistory[freelancer].times.includes(dateTimePairs[dateStr])) {
                    freelancerHistory[freelancer].times.push(dateTimePairs[dateStr]);
                }
            });
            
            saveSchedules(); // ì¼ì • ì €ì¥
            
            alert(`${addedCount}ê°œì˜ ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\n"${freelancer}"ë‹˜ì—ê²Œ ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.`);
            
            closeAddScheduleModal();
            event.target.reset();
            
            // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
            if (selectedFreelancer) {
                updateFreelancerSummary();
            }
            
            renderTodaySchedules();
            renderCalendar();
            renderScheduleList();
        }

        // ============================================
        // Firebase ì•± ì´ˆê¸°í™”
        // ============================================
        
        async function initApp() {
            console.log('ğŸš€ ì•± ì´ˆê¸°í™” ì‹œì‘...');
            
            // Firebaseì—ì„œ ëª¨ë“  ë°ì´í„° ë¡œë“œ
            await loadAccounts();
            await loadPendingUsers();
            await loadSchedules();
            
            console.log('âœ… ì•± ì´ˆê¸°í™” ì™„ë£Œ!');
            
            // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
            document.getElementById('loginScreen').style.display = 'block';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•± ì´ˆê¸°í™”
        initApp().catch(error => {
            console.error('ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            alert('ì•± ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        });

        // ============================================
        // ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ (onclick ì´ë²¤íŠ¸ìš©)
        // ============================================
        window.showLoginScreen = showLoginScreen;
        window.showSignupScreen = showSignupScreen;
        window.handleLogin = handleLogin;
        window.handleSignup = handleSignup;
        window.handleLogout = handleLogout;
        window.switchView = switchView;
        window.openAddScheduleModal = openAddScheduleModal;
        window.closeAddScheduleModal = closeAddScheduleModal;
        window.addSchedule = addSchedule;
        window.updateSchedule = updateSchedule;
        window.changeMonth = changeMonth;
        window.changeBulkMonth = changeBulkMonth;
        window.showDateDetail = showDateDetail;
        window.closeDateDetailModal = closeDateDetailModal;
        window.confirmSchedule = confirmSchedule;
        window.filterSchedules = filterSchedules;
        window.filterByFreelancer = filterByFreelancer;
        window.setDateRange = setDateRange;
        window.downloadExcel = downloadExcel;
        window.openEditScheduleModal = openEditScheduleModal;
        window.saveScheduleEdit = saveScheduleEdit;
        window.closeEditScheduleModal = closeEditScheduleModal;
        window.deleteSchedule = deleteSchedule;
        window.approveUser = approveUser;
        window.rejectUser = rejectUser;
        window.deleteUser = deleteUser;
        window.resetPassword = resetPassword;
        window.startMeeting = startMeeting;
        window.pauseMeeting = pauseMeeting;
        window.resumeMeeting = resumeMeeting;
        window.endMeeting = endMeeting;
        window.editTimeLog = editTimeLog;
        window.saveTimeLogEdit = saveTimeLogEdit;
        window.closeEditTimeLogModal = closeEditTimeLogModal;
        window.updateDateTime = updateDateTime;
        window.updateFreelancerSuggestions = updateFreelancerSuggestions;
    </script>
</body>
</html>
